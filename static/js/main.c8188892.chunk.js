(this.webpackJsonpvca=this.webpackJsonpvca||[]).push([[0],{27:function(e,t,n){e.exports=n(46)},32:function(e,t,n){},33:function(e,t,n){},46:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(23),i=n.n(o),c=(n(32),n(10)),l=(n(33),n(17),n(24),n(0));var s=function(e,t){var n=l.Loader.shared;n.resources[e]?t(n.resources[e]):n.add(e).load((function(n,r){t(r[e])}))},u=n(7),d=n(15),f=n(19),m=function(e){var t=Object(r.useState)({}),n=Object(c.a)(t,2),a=n[0],o=n[1],i=Object(r.useState)(),l=Object(c.a)(i,2),u=l[0],m=l[1];return Object(r.useEffect)((function(){if(u){console.log("loading tilesets",u);var t=h(u,a);if(t){var n=t.name,r=e(t);s("".concat(r),(function(e){if(e.error)throw new Error("Loading ".concat(r,"\n").concat(e.error));var t=Object(f.a)(Object(f.a)({},a),{},Object(d.a)({},n,e));o(t)}))}}}),[u,e,a]),{loadComplete:!!u&&void 0===h(u,a),loadTilesets:function(e){m(e)},tilesetsTextures:a}},h=function(e,t){return e.find((function(e){return!t[e.name]}))},v=n(26),p=Object(r.forwardRef)((function(e,t){var n=Object(u.useApp)();return window.PIXI=l,a.a.createElement(w,Object.assign({app:n},e,{ref:t}))})),w=Object(u.PixiComponent)("Viewport",{create:function(e){var t=new v.a({screenWidth:e.screenWidth,screenHeight:e.screenHeight,worldWidth:e.worldWidth,worldHeight:e.worldHeight,ticker:e.app.ticker});t.on("clicked",(function(t){e.onClick&&e.onClick(t)}));var n=e.minScale,r=void 0===n?.5:n,a=e.maxScale,o=void 0===a?1:a;return t.drag().pinch().wheel().clamp({direction:"all"}).clampZoom({minScale:r,maxScale:o}).decelerate(),t}}),g=p,j=function(e,t,n){var r=32*(n-t)+128*(n+t)/2/2+64*e[0]+64*-e[1],a=64*(e[0]+e[1])/2+64+128;return new l.Point(r,a)};window.PIXI=l,n(45);var E=Object(u.PixiComponent)("FloorTileLayer",{create:function(e){return new window.PIXI.tilemap.CompositeRectTileLayer(0,[e.texture])},applyProps:function(e,t,n){var r=n.layer,a=n.tileset,o=n.verticalTiles,i=n.horizontalTiles,c=n.spritesheet;if(r.data)for(var l=function(t){if(r.data[t]>0){var n=[t%i,Math.floor(t/i)],l=j(n,i,o),s=a.tiles.find((function(e){return e.id===r.data[t]-a.firstgid})),u=null===s||void 0===s?void 0:s.image.substr((null===s||void 0===s?void 0:s.image.lastIndexOf("/"))+1);e.addFrame(c.textures[u],l.x-64,l.y-64)}},s=0;s<r.data.length;s++)l(s)}}),b=window.innerWidth,O=window.innerHeight;var x=function(e){var t=e.jsonPath,n=Object(r.useState)(),o=Object(c.a)(n,2),i=o[0],d=o[1];l.settings.ROUND_PIXELS=!0;var f=m(y),h=f.loadComplete,v=f.loadTilesets,p=f.tilesetsTextures;Object(r.useEffect)((function(){l.settings.SCALE_MODE=l.SCALE_MODES.NEAREST,s("".concat("/vca","/").concat(t),(function(e){d(e.data)}))}),[t]),Object(r.useEffect)((function(){console.log("mapdata changed",i),i&&v(i.tilesets)}),[v,i]);var w=64*(((null===i||void 0===i?void 0:i.width)||1)+((null===i||void 0===i?void 0:i.height)||1)),x=32*(((null===i||void 0===i?void 0:i.width)||1)+((null===i||void 0===i?void 0:i.height)||1))+128,k=Object(r.useRef)(null);if(Object(r.useEffect)((function(){k.current&&i&&k.current.moveCenter(w/2,x/2)}),[i,x,w]),!h||!i)return a.a.createElement("div",null,"Loading...");var T=function(e,t,n){return e.map((function(e,r){var o=536870911&e,l=C(o,i.tilesets);if(!l||!l.tiles||0===e)return null;var s=i.width,d=r%s,f=Math.floor(r/s),m=0!==(1073741824&e),h=[1,1];0!==(2147483648&e)&&(h[0]*=-1),m&&(h[1]*=-1);var v=l.tiles.find((function(e){return e.id===o-l.firstgid}));if(!v)return null;var w=v.image.split("/"),g=Object(c.a)(w,3),E=(g[0],g[1]),b=g[2];return p[E]||console.warn("Could not find spritesheet ".concat(E," ").concat(p)),p[E].textures[b]||console.warn("Could not find texture ".concat(E," ").concat(b)),a.a.createElement(u.Sprite,{key:r,name:"".concat(t.name,": ").concat(d,",").concat(f," (").concat(b,")"),scale:h,texture:p[E].textures[b],anchor:[0,1],pivot:[64,0],position:j([d,f],i.width,i.height),zIndex:100*r+n})}))};return a.a.createElement(u.Stage,{width:b,height:O,className:"background",options:{sharedLoader:!0,backgroundColor:3046323}},a.a.createElement(g,{worldWidth:w,worldHeight:x,screenWidth:b,screenHeight:O,ref:k},function(e){if(!e)return console.warn("No layer with name 'floor' found!"),null;var t=S(e).find(Boolean);if(!t)return console.warn("Layer with name 'floor' is empty?"),null;var n=C(536870911&t,i.tilesets);if(!n)return console.warn("No tileset found for floor layer. Huh?"),null;var r=p[n.name];return l.utils.clearTextureCache(),r.spritesheet?a.a.createElement(E,{texture:r.spritesheet._texture,verticalTiles:i.height,horizontalTiles:i.width,layer:e,tileset:n,spritesheet:r.spritesheet}):(console.warn("No texture loaded found for floor layer. Was looking for ".concat(n.name)),null)}(i.layers.find((function(e){return"floor"===e.name}))),a.a.createElement(u.Graphics,{name:"selectioncircle",draw:function(e){e.lineStyle(3,16777215),e.drawCircle(0,0,5),e.endFill()},position:j([0,0],i.width,i.height)}),a.a.createElement(u.Container,{sortableChildren:!0},i.layers.filter((function(e){return e.visible&&"floor"!==e.name})).map((function(e,t){var n=S(e);return T(n,e,t)})))))},y=function(e){return"".concat("/vca","/maps/tilesets/").concat(e.name,".json")},C=function(e,t){for(var n,r=t.length-1;r>=0&&!((n=t[r]).firstgid<=e);r--);return n},S=function(e){var t=e.data;return"string"!==typeof t?t:(e.encoding,e.compression,[])};var k=function(){var e=Object(r.useState)("maps/testmap3.json"),t=Object(c.a)(e,2),n=t[0],o=t[1];return a.a.createElement("div",{className:"App"},a.a.createElement("select",{value:n,onChange:function(e){return o(e.currentTarget.value)}},a.a.createElement("option",null,"maps/testmap1.json"),a.a.createElement("option",null,"maps/testmap2.json"),a.a.createElement("option",null,"maps/testmap3.json"),a.a.createElement("option",null,"maps/testmap4.json")),a.a.createElement(x,{jsonPath:n}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(k,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[27,1,2]]]);
//# sourceMappingURL=main.c8188892.chunk.js.map
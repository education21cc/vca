(this.webpackJsonpvca=this.webpackJsonpvca||[]).push([[0],{27:function(e,t,n){e.exports=n(46)},32:function(e,t,n){},33:function(e,t,n){},46:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(23),i=n.n(o),c=(n(32),n(10)),l=(n(33),n(17),n(24),n(0));var s=function(e,t){var n=l.Loader.shared;n.resources[e]?t(n.resources[e]):n.add(e).load((function(n,r){t(r[e])}))},u=n(8),d=n(15),f=n(19),m=function(e){var t=Object(r.useState)({}),n=Object(c.a)(t,2),a=n[0],o=n[1],i=Object(r.useState)(),l=Object(c.a)(i,2),u=l[0],m=l[1];return Object(r.useEffect)((function(){if(u){var t=h(u,a);if(t){var n=t.name,r=e(t);s("".concat(r),(function(e){if(e.error)throw new Error("Loading ".concat(r,"\n").concat(e.error));var t=Object(f.a)(Object(f.a)({},a),{},Object(d.a)({},n,e));o(t)}))}}}),[u,e,a]),{loadComplete:!!u&&void 0===h(u,a),loadTilesets:function(e){m(e)},tilesetsTextures:a}},h=function(e,t){return e.find((function(e){return!t[e.name]}))},v=n(26),p=Object(r.forwardRef)((function(e,t){var n=Object(u.useApp)();return window.PIXI=l,a.a.createElement(w,Object.assign({app:n},e,{ref:t}))})),w=Object(u.PixiComponent)("Viewport",{create:function(e){var t=new v.a({screenWidth:e.screenWidth,screenHeight:e.screenHeight,worldWidth:e.worldWidth,worldHeight:e.worldHeight,ticker:e.app.ticker});t.on("clicked",(function(t){e.onClick&&e.onClick(t)}));var n=e.minScale,r=void 0===n?.5:n,a=e.maxScale,o=void 0===a?1:a;return t.drag().pinch().wheel().clamp({direction:"all"}).clampZoom({minScale:r,maxScale:o}).decelerate(),t}}),g=p,b=function(e,t){var n=128*(e[0]-e[1])/2+128*t/2,r=64*(e[0]+e[1])/2+64+128;return new l.Point(n,r)};window.PIXI=l,n(45);var j=Object(u.PixiComponent)("FloorTileLayer",{create:function(e){return new window.PIXI.tilemap.CompositeRectTileLayer(0,[e.texture])},applyProps:function(e,t,n){var r=n.layer,a=n.tileset,o=n.horizontalTiles,i=n.spritesheet;if(r.data)for(var c=function(t){if(r.data[t]>0){var n=[t%o,Math.floor(t/o)],c=b(n,o),l=a.tiles.find((function(e){return e.id===r.data[t]-a.firstgid})),s=null===l||void 0===l?void 0:l.image.substr((null===l||void 0===l?void 0:l.image.lastIndexOf("/"))+1);e.addFrame(i.textures[s],c.x-64,c.y-64)}},l=0;l<r.data.length;l++)c(l)}});var E=function(e){var t=e.jsonPath,n=Object(r.useState)(),o=Object(c.a)(n,2),i=o[0],d=o[1];l.settings.ROUND_PIXELS=!0;var f=m(O),h=f.loadComplete,v=f.loadTilesets,p=f.tilesetsTextures;Object(r.useEffect)((function(){l.settings.SCALE_MODE=l.SCALE_MODES.NEAREST,s("".concat("/vca","/").concat(t),(function(e){d(e.data)}))}),[t]),Object(r.useEffect)((function(){i&&v(i.tilesets)}),[v,i]);var w=128*((null===i||void 0===i?void 0:i.width)||1),E=64*((null===i||void 0===i?void 0:i.height)||1)+128,C=Object(r.useRef)(null);if(Object(r.useEffect)((function(){C.current&&i&&(C.current.moveCenter(w/2,E/2),console.log("hi"))}),[i,E,w]),!h||!i)return a.a.createElement("div",null,"Loading...");var y=function(e,t){return e.data.map((function(n,r){var o=536870911&n,l=x(o,i.tilesets);if(!l||!l.tiles||0===n)return null;var s=i.width,d=r%s,f=Math.floor(r/s),m=0!==(1073741824&n),h=[1,1];0!==(2147483648&n)&&(h[0]*=-1),m&&(h[1]*=-1);var v=l.tiles.find((function(e){return e.id===o-l.firstgid}));if(!v)return null;var w=v.image.split("/"),g=Object(c.a)(w,3),j=(g[0],g[1]),E=g[2];return p[j]||console.warn("Could not find spritesheet ".concat(j," ").concat(p)),p[j].textures[E]||console.warn("Could not find texture ".concat(j," ").concat(E)),a.a.createElement(u.Sprite,{key:r,name:"".concat(e.name,": ").concat(d,",").concat(f," (").concat(E,")"),scale:h,texture:p[j].textures[E],anchor:[0,1],pivot:[64,0],position:b([d,f],i.width),zIndex:100*r+t})}))};return a.a.createElement(u.Stage,{width:1280,height:720,className:"background",options:{sharedLoader:!0,backgroundColor:0}},a.a.createElement(g,{worldWidth:w,worldHeight:E,screenWidth:1280,screenHeight:720,ref:C},function(e){if(!e)return console.warn("No layer with name 'floor' found!"),null;var t=e.data.find(Boolean);if(!t)return console.warn("Layer with name 'floor' is empty?"),null;var n=x(536870911&t,i.tilesets);if(!n)return console.warn("No tileset found for floor layer. Huh?"),null;var r=p[n.name];return l.utils.clearTextureCache(),r.spritesheet?a.a.createElement(j,{texture:r.spritesheet._texture,horizontalTiles:i.width,layer:e,tileset:n,spritesheet:r.spritesheet}):(console.warn("No texture loaded found for floor layer. Was looking for ".concat(n.name)),null)}(i.layers.find((function(e){return"floor"===e.name}))),a.a.createElement(u.Container,{sortableChildren:!0},i.layers.filter((function(e){return e.visible&&"floor"!==e.name})).map((function(e,t){return y(e,t)})))))},O=function(e){return"".concat("/vca","/maps/tilesets/").concat(e.name,".json")},x=function(e,t){for(var n,r=t.length-1;r>=0&&!((n=t[r]).firstgid<=e);r--);return n};var C=function(){var e=Object(r.useState)("maps/testmap2.json"),t=Object(c.a)(e,2),n=t[0],o=t[1];return a.a.createElement("div",{className:"App"},a.a.createElement("select",{value:n,onChange:function(e){return o(e.currentTarget.value)}},a.a.createElement("option",null,"maps/testmap1.json"),a.a.createElement("option",null,"maps/testmap2.json")),a.a.createElement(E,{jsonPath:n}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(C,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[27,1,2]]]);
//# sourceMappingURL=main.46a56a89.chunk.js.map
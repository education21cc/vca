(this.webpackJsonpvca=this.webpackJsonpvca||[]).push([[0],{33:function(e,t,n){e.exports=n(64)},38:function(e,t,n){},39:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(18),i=n.n(r),c=(n(38),n(9)),l=(n(39),n(19),n(29),n(1));var s=function(e,t){var n=l.Loader.shared;n.resources[e]?t(n.resources[e]):n.add(e).load((function(n,a){t(a[e])}))},u=n(7),d=n(15),f=n(21),m=function(e){var t=Object(a.useState)({}),n=Object(c.a)(t,2),o=n[0],r=n[1],i=Object(a.useState)(),l=Object(c.a)(i,2),u=l[0],m=l[1];return Object(a.useEffect)((function(){if(u){console.log("loading tilesets",u);var t=h(u,o);if(t){var n=t.name,a=e(t);s("".concat(a),(function(e){if(e.error)throw new Error("Loading ".concat(a,"\n").concat(e.error));var t=Object(f.a)(Object(f.a)({},o),{},Object(d.a)({},n,e));r(t)}))}}}),[u,e,o]),{loadComplete:!!u&&void 0===h(u,o),loadTilesets:function(e){m(e)},tilesetsTextures:o}},h=function(e,t){return e.find((function(e){return!t[e.name]}))},v=n(31),p=Object(a.forwardRef)((function(e,t){var n=Object(u.useApp)();return window.PIXI=l,o.a.createElement(w,Object.assign({app:n},e,{ref:t}))})),w=Object(u.PixiComponent)("Viewport",{create:function(e){var t=new v.a({screenWidth:e.screenWidth,screenHeight:e.screenHeight,worldWidth:e.worldWidth,worldHeight:e.worldHeight,ticker:e.app.ticker});t.on("clicked",(function(t){e.onClick&&e.onClick(t)}));var n=e.minScale,a=void 0===n?.3:n,o=e.maxScale,r=void 0===o?1:o;return t.drag().pinch().wheel().clamp({direction:"all"}).clampZoom({minScale:a,maxScale:r}).decelerate(),t}}),g=p,E=function(e,t,n){var a=32*(n-t)+128*(n+t)/2/2+64*e[0]+64*-e[1],o=64*(e[0]+e[1])/2+64+128;return new l.Point(a,o)};window.PIXI=l,n(51);var b=Object(u.PixiComponent)("FloorTileLayer",{create:function(e){return new window.PIXI.tilemap.CompositeRectTileLayer(0,[e.texture])},applyProps:function(e,t,n){var a=n.layer,o=n.tileset,r=n.verticalTiles,i=n.horizontalTiles,c=n.spritesheet;if(a.data)for(var l=function(t){if(a.data[t]>0){var n=[t%i,Math.floor(t/i)],l=E(n,i,r),s=o.tiles.find((function(e){return e.id===a.data[t]-o.firstgid})),u=null===s||void 0===s?void 0:s.image.substr((null===s||void 0===s?void 0:s.image.lastIndexOf("/"))+1);e.addFrame(c.textures[u],l.x-64,l.y-64)}},s=0;s<a.data.length;s++)l(s)}}),j=window.innerWidth,O=window.innerHeight;var C=function(e){var t=e.jsonPath,n=Object(a.useState)(),r=Object(c.a)(n,2),i=r[0],d=r[1];l.settings.ROUND_PIXELS=!0;var f=m(y),h=f.loadComplete,v=f.loadTilesets,p=f.tilesetsTextures;Object(a.useEffect)((function(){l.settings.SCALE_MODE=l.SCALE_MODES.NEAREST,s("".concat("/vca","/").concat(t),(function(e){d(e.data)}))}),[t]),Object(a.useEffect)((function(){console.log("mapdata changed",i),i&&v(i.tilesets)}),[v,i]);var w=64*(((null===i||void 0===i?void 0:i.width)||1)+((null===i||void 0===i?void 0:i.height)||1)),C=32*(((null===i||void 0===i?void 0:i.width)||1)+((null===i||void 0===i?void 0:i.height)||1))+128,k=Object(a.useRef)(null);if(Object(a.useEffect)((function(){k.current&&i&&k.current.moveCenter(w/2,C/2)}),[i,C,w]),!h||!i)return o.a.createElement("div",null,"Loading...");var N=function(e,t,n){return e.map((function(e,a){var r=536870911&e,l=x(r,i.tilesets);if(!l||!l.tiles||0===e)return null;var s=i.width,d=a%s,f=Math.floor(a/s),m=0!==(1073741824&e),h=[1,1];0!==(2147483648&e)&&(h[0]*=-1),m&&(h[1]*=-1);var v=l.tiles.find((function(e){return e.id===r-l.firstgid}));if(!v)return null;var w=v.image.split("/"),g=Object(c.a)(w,3),b=(g[0],g[1]),j=g[2];return p[b]||console.warn("Could not find spritesheet ".concat(b," ").concat(p)),p[b].textures[j]||console.warn("Could not find texture ".concat(b," ").concat(j)),o.a.createElement(u.Sprite,{key:a,name:"".concat(t.name,": ").concat(d,",").concat(f," (").concat(j,")"),scale:h,texture:p[b].textures[j],anchor:[0,1],pivot:[64,0],position:E([d,f],i.width,i.height),zIndex:100*a+n})}))},I={sharedLoader:!0,backgroundColor:S(null===i||void 0===i?void 0:i.backgroundcolor)};return o.a.createElement(u.Stage,{width:j,height:O,className:"background",options:I},o.a.createElement(g,{worldWidth:w,worldHeight:C,screenWidth:j,screenHeight:O,ref:k},function(e){if(!e)return console.warn("No layer with name 'floor' found!"),null;var t=T(e).find(Boolean);if(!t)return console.warn("Layer with name 'floor' is empty?"),null;var n=x(536870911&t,i.tilesets);if(!n)return console.warn("No tileset found for floor layer. Huh?"),null;var a=p[n.name];return l.utils.clearTextureCache(),a.spritesheet?o.a.createElement(b,{texture:a.spritesheet._texture,verticalTiles:i.height,horizontalTiles:i.width,layer:e,tileset:n,spritesheet:a.spritesheet}):(console.warn("No texture loaded found for floor layer. Was looking for ".concat(n.name)),null)}(i.layers.find((function(e){return"floor"===e.name}))),o.a.createElement(u.Graphics,{name:"selectioncircle",draw:function(e){e.lineStyle(3,16777215),e.drawCircle(0,0,5),e.endFill()},position:E([0,0],i.width,i.height)}),o.a.createElement(u.Container,{sortableChildren:!0},i.layers.filter((function(e){return e.visible&&"floor"!==e.name})).map((function(e,t){var n=T(e);return N(n,e,t)})))))},y=function(e){return"".concat("/vca","/maps/tilesets/").concat(e.name,".json")},x=function(e,t){for(var n,a=t.length-1;a>=0&&!((n=t[a]).firstgid<=e);a--);return n},S=function(e){if(e)return parseInt(e.substring(1),16)},T=function(e){var t=e.data;return"string"!==typeof t?t:(e.encoding,e.compression,[])},k=n(32),N=n.n(k),I=(n(63),function(e){var t=e.onClose,n=function(){t()};return o.a.createElement(N.a,{isOpen:!0,ariaHideApp:!1,portalClassName:"modal-portal",overlayClassName:"modal-overlay",className:"modal",onRequestClose:n},o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"header"},o.a.createElement("h1",null,"TEST "),o.a.createElement("div",{className:"modal-close",onClick:function(){return n()}})),o.a.createElement("iframe",{src:"https://21cceducation.nl/content/webgl_portfolio/games/ConveyorGame/"})))});var L=function(){var e=Object(a.useState)("maps/testmap3.json"),t=Object(c.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),l=Object(c.a)(i,2),s=l[0],u=l[1],d=function(){u(!0)};return Object(a.useEffect)((function(){setTimeout(d,5e3)}),[]),o.a.createElement("div",{className:"App",onDoubleClick:d},"TEst",o.a.createElement("select",{value:n,onChange:function(e){return r(e.currentTarget.value)}},o.a.createElement("option",null,"maps/testmap1.json"),o.a.createElement("option",null,"maps/testmap2.json"),o.a.createElement("option",null,"maps/testmap3.json"),o.a.createElement("option",null,"maps/testmap4.json")),s&&o.a.createElement(I,{onClose:function(){u(!1)}}),o.a.createElement(C,{jsonPath:n}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[33,1,2]]]);
//# sourceMappingURL=main.13af0a6a.chunk.js.map
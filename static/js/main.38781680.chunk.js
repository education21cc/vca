(this.webpackJsonpvca=this.webpackJsonpvca||[]).push([[0],{29:function(e){e.exports=JSON.parse('{"alpha":{"start":0.25,"end":0},"scale":{"start":0.04,"end":0.29,"minimumScaleMultiplier":1},"color":{"start":"#85888d","end":"#100f0c"},"speed":{"start":100,"end":200,"minimumSpeedMultiplier":1},"acceleration":{"x":10,"y":-30},"maxSpeed":200,"startRotation":{"min":265,"max":270},"noRotation":false,"rotationSpeed":{"min":8,"max":0},"lifetime":{"min":0.5,"max":3.05},"blendMode":"normal","frequency":0.0005,"emitterLifetime":-1,"maxParticles":300,"pos":{"x":0,"y":0},"addAtBack":true,"spawnType":"point"}')},33:function(e,t,n){e.exports=n(56)},38:function(e,t,n){},39:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){},55:function(e,t,n){},56:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(25),o=n.n(i),c=(n(38),n(31)),l=n(3),u=(n(39),n(19),n(26),n(1));var s,f,d,m=function(e,t){var n=u.Loader.shared;n.resources[e]?t(n.resources[e]):n.add(e).load((function(n,a){t(a[e])}))},v=n(2);!function(e){e.tilelayer="tilelayer",e.objectgroup="objectgroup"}(s||(s={})),function(e){e.orthagonal="orthagonal",e.isometric="isometric",e.staggered="staggered",e.hexagonal="hexagonal"}(f||(f={})),function(e){e.rightUp="right-up",e.rightDown="right-down",e.leftUp="left-up",e.leftDown="left-down"}(d||(d={}));var p=n(18),h=n(21),g=function(e){var t=Object(a.useState)({}),n=Object(l.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)(),c=Object(l.a)(o,2),u=c[0],s=c[1];return Object(a.useEffect)((function(){if(u){var t=w(u,r);if(t){var n=t.name,a=e(t);m("".concat(a),(function(e){if(e.error)throw new Error("Loading ".concat(a,"\n").concat(e.error));var t=Object(h.a)(Object(h.a)({},r),{},Object(p.a)({},n,e));i(t)}))}}}),[u,e,r]),{loadComplete:!!u&&void 0===w(u,r),loadTilesets:function(e){s(e)},tilesetsTextures:r}},w=function(e,t){return e.find((function(e){return!t[e.name]}))},b=n(28),y=Object(a.forwardRef)((function(e,t){var n=Object(v.useApp)();return window.PIXI=u,r.a.createElement(O,Object.assign({app:n},e,{ref:t}))})),O=Object(v.PixiComponent)("Viewport",{create:function(e){var t=new b.a({screenWidth:e.screenWidth,screenHeight:e.screenHeight,worldWidth:e.worldWidth,worldHeight:e.worldHeight,ticker:e.app.ticker});t.on("clicked",(function(t){e.onClick&&e.onClick(t)}));var n=e.minScale,a=void 0===n?.3:n,r=e.maxScale,i=void 0===r?1:r;return t.drag().pinch().wheel().clamp({direction:"all"}).setZoom(.4).clampZoom({minScale:a,maxScale:i}).decelerate(),t}}),E=y,x=function(e,t,n){var a=j(t,n)+64*e[0]+64*-e[1],r=64*(e[0]+e[1])/2+64+128;return new u.Point(a,r)},j=function(e,t){return 32*(t-e)+128*(t+e)/2/2};window.PIXI=u,n(51);var k=Object(v.PixiComponent)("FloorTileLayer",{create:function(e){return new window.PIXI.tilemap.CompositeRectTileLayer(0,[e.texture])},applyProps:function(e,t,n){var a=n.layer,r=n.tileset,i=n.verticalTiles,o=n.horizontalTiles,c=n.spritesheet;if(a.data)for(var l=function(t){if(a.data[t]>0){var n=[t%o,Math.floor(t/o)],l=x(n,o,i),u=r.tiles.find((function(e){return e.id===a.data[t]-r.firstgid})),s=null===u||void 0===u?void 0:u.image.substr((null===u||void 0===u?void 0:u.image.lastIndexOf("/"))+1);e.addFrame(c.textures[s],l.x-64,l.y-64)}},u=0;u<a.data.length;u++)l(u)}}),S=n(11),C=function(e){var t=Object(a.useRef)(null),n=Object(a.useRef)(),i=Object(a.useState)(e.position||new u.Point),o=Object(l.a)(i,2),c=o[0],s=(o[1],e.bounce?"".concat("/vca","/images/ui/marker.svg"):"".concat("/vca","/images/ui/marker-green.svg"));Object(a.useEffect)((function(){S.a.from(t.current,{duration:1,ease:"elastic.out(2, 0.5)",pixi:{visible:!1,scale:.1}}).delay(e.delay||0)}),[e.delay]),Object(a.useEffect)((function(){var n;return!1!==e.bounce&&(n=S.a.to(t.current,{duration:.5,yoyo:!0,repeat:-1,pixi:{y:"-=40"}}).delay(1+Math.random())),function(){var e;null===(e=n)||void 0===e||e.kill()}}),[e.bounce]);var f=function(e){},d=function(){n.current=void 0},m=function(){};return r.a.createElement(v.Sprite,Object.assign({},e,{anchor:[.5,.5],position:c,ref:t,interactive:!0,image:s,mousedown:f,touchstart:f,mouseup:d,mouseupoutside:d,mousemove:m,touchmove:m}))},P=function(e,t){for(var n,a=t.length-1;a>=0&&!((n=t[a]).firstgid<=e);a--);return n},T=n(29),N=n(32),A=n(30),R=Object(v.PixiComponent)("ParticleEmitter",{create:function(){return new u.ParticleContainer},applyProps:function(e,t,n){var a=n.image,r=n.config,i=Object(N.a)(n,["image","config"]);Object(v.applyDefaultProps)(e,t,i);var o=this._emitter;if(!o){o=new A.a(e,[u.Texture.from(a)],r);var c=performance.now();o.emit=!0,function e(){o.raf=requestAnimationFrame(e);var t=performance.now();o.update(3e-4*(t-c)),c=t}()}this._emitter=o},willUnmount:function(){this._emitter&&(this._emitter.emit=!1,cancelAnimationFrame(this._emitter.raf))}}),M=function(e){var t=e.x,n=void 0===t?0:t,a=e.y,i=void 0===a?0:a;return r.a.createElement(R,{name:"smoke",x:n,y:i,image:"".concat("/vca","/effects/smokeparticle.png"),config:T,pivot:[-64,0]})},D=function(e){var t=e.data,n=e.mapData,i=e.tilesetsTextures,o=e.found,c=e.onClick,u=Object(a.useRef)(null);if(Object(a.useEffect)((function(){u.current&&S.a.from(u.current,{duration:1,ease:"elastic.out(2, 0.5)",pixi:{visible:!1,scale:.1}})}),[o]),t.polygon){var s=[t.x/64,t.y/64],f=t.polygon.reduce((function(e,t){return e.push(t.y+t.x),e.push(t.y/2-t.x/2),e}),[]);return r.a.createElement(v.Graphics,{key:"".concat(t.type).concat(t.name),draw:function(e){e.beginFill(12245589),e.drawPolygon(f),e.endFill()},position:x(s,n.width,n.height),pivot:[64,32]})}if(t.gid){var d=t.x,m=t.y,p=t.gid,h=[d/64-1,m/64-1],g=536870911&p,w=P(g,n.tilesets);if(!w||!w.tiles||0===p)return null;var b=0!==(1073741824&p),y=[1,1];0!==(2147483648&p)&&(y[0]*=-1),b&&(y[1]*=-1);var O=w.tiles.find((function(e){return e.id===g-w.firstgid}));if(!O)return null;var E=O.image.split("/"),j=Object(l.a)(E,3),k=(j[0],j[1]),C=j[2];return i[k]||console.warn("Could not find spritesheet ".concat(k," ").concat(i)),i[k].textures[C]||console.warn("Could not find texture ".concat(k," ").concat(C)),r.a.createElement(v.Sprite,{name:"".concat(t.name,": ").concat(d,",").concat(m," (").concat(C,")"),scale:y,texture:i[k].textures[C],anchor:[0,1],pivot:[64,0],position:x(h,n.width,n.height),pointerdown:function(){return c(t.name)},interactive:!!t.name},I(t.properties),o&&r.a.createElement(v.Sprite,{ref:u,image:"".concat("/vca","/images/ui/check.svg"),scale:.8,anchor:[-.1,1],pivot:[64,0]}))}return null},I=function(e){if(!e)return null;var t,n,a=e.find((function(e){return"offset"===e.name}));if(a){var i=a.value.split(","),o=Object(l.a)(i,2);t=o[0],n=o[1]}return r.a.createElement(M,{x:t,y:n})},L=window.innerWidth,B=window.innerHeight;var W=function(e){var t=e.content,n=e.foundSituations,i=e.onSituationClick,o=t.mapJson,c=Object(a.useState)(),f=Object(l.a)(c,2),d=f[0],p=f[1];u.settings.ROUND_PIXELS=!0;var h=g(_),w=h.loadComplete,b=h.loadTilesets,y=h.tilesetsTextures;Object(a.useEffect)((function(){u.settings.SCALE_MODE=u.SCALE_MODES.NEAREST,m("".concat("/vca","/").concat(o),(function(e){p(e.data)}))}),[o]),Object(a.useEffect)((function(){d&&b(d.tilesets)}),[b,d]);var O=64*(((null===d||void 0===d?void 0:d.width)||1)+((null===d||void 0===d?void 0:d.height)||1)),j=32*(((null===d||void 0===d?void 0:d.width)||1)+((null===d||void 0===d?void 0:d.height)||1))+128,S=Object(a.useRef)(null);if(Object(a.useEffect)((function(){S.current&&S.current.moveCenter(O/2,j/2)}),[d,j,O,y]),!w||!d)return r.a.createElement("div",null,"Loading...");var T=function(e,t,n){return e.map((function(e,a){var i=536870911&e,o=P(i,d.tilesets);if(!o||!o.tiles||0===e)return null;var c=d.width,u=a%c,s=Math.floor(a/c),f=0!==(1073741824&e),m=[1,1];0!==(2147483648&e)&&(m[0]*=-1),f&&(m[1]*=-1);var p=o.tiles.find((function(e){return e.id===i-o.firstgid}));if(!p)return null;var h=p.image.split("/"),g=Object(l.a)(h,3),w=(g[0],g[1]),b=g[2];return y[w]||console.warn("Could not find spritesheet ".concat(w," ").concat(y)),y[w].textures[b]||console.warn("Could not find texture ".concat(w," ").concat(b)),r.a.createElement(v.Sprite,{key:a,name:"".concat(t.name,": ").concat(u,",").concat(s," (").concat(b,")"),scale:m,texture:y[w].textures[b],anchor:[0,1],pivot:[64,0],position:x([u,s],d.width,d.height),zIndex:100*a+n})}))},N=function(e){return e.map((function(e,t){var a=n.indexOf(e.name)>-1;return r.a.createElement(D,{data:e,key:"".concat(e.type).concat(e.name).concat(t),found:a,tilesetsTextures:y,mapData:d,onClick:i})}))},A=function(t,n,a){var i=.5*a,o=x(n.location,d.width,d.height);return r.a.createElement(C,{position:o,pointertap:function(){return function(t,n){e.onScenarioClick(t)}(t)},delay:i,bounce:!0,key:t,name:t})},R={sharedLoader:!0,backgroundColor:H(null===d||void 0===d?void 0:d.backgroundcolor)};return r.a.createElement(v.Stage,{width:L,height:B,className:"background",options:R},r.a.createElement(E,{worldWidth:O,worldHeight:j,screenWidth:L,screenHeight:B,ref:S},function(e){if(!e)return console.warn("No layer with name 'floor' found!"),null;var t=G(e).find(Boolean);if(!t)return console.warn("Layer with name 'floor' is empty?"),null;var n=P(536870911&t,d.tilesets);if(!n)return console.warn("No tileset found for floor layer. Huh?"),null;var a=y[n.name];return u.utils.clearTextureCache(),a.spritesheet?r.a.createElement(k,{texture:a.spritesheet._texture,verticalTiles:d.height,horizontalTiles:d.width,layer:e,tileset:n,spritesheet:a.spritesheet}):(console.warn("No texture loaded found for floor layer. Was looking for ".concat(n.name)),null)}(d.layers.find((function(e){return"floor"===e.name}))),r.a.createElement(v.Container,{sortableChildren:!0},d.layers.filter((function(e){return e.visible&&"floor"!==e.name&&e.type===s.tilelayer})).map((function(e,t){var n=G(e);return T(n,e,t)}))),function(e){return e.filter((function(e){return e.visible&&e.type===s.objectgroup})).map((function(e){return N(e.objects)}))}(d.layers),Object.entries(t.scenarios).map((function(e,t){var n=Object(l.a)(e,2),a=n[0],r=n[1];return A(a,r,t)}))))},_=function(e){return"".concat("/vca","/maps/tilesets/").concat(e.name,".json")},H=function(e){if(e)return parseInt(e.substring(1),16)},G=function(e){var t=e.data;return"string"!==typeof t?t:(e.encoding,e.compression,[])};n(52);function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function X(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var J=r.a.createElement("defs",null,r.a.createElement("style",null,".a{fill:#fff;}.a,.b{stroke:#283583;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.75px;}.b{fill:none;}")),U=r.a.createElement("title",null,"Back"),z=r.a.createElement("circle",{className:"a",cx:15.02,cy:15.02,r:14.65}),q=r.a.createElement("path",{className:"b",d:"M11.64,16",transform:"translate(-0.97 -0.93)"}),Z=r.a.createElement("path",{className:"b",d:"M11.63,16",transform:"translate(-0.97 -0.93)"}),V=r.a.createElement("path",{className:"b",d:"M20.38,22.88",transform:"translate(-0.97 -0.93)"}),$=r.a.createElement("line",{className:"b",x1:19.39,y1:8.16,x2:10.65,y2:15.02}),K=r.a.createElement("line",{className:"b",x1:19.39,y1:21.98,x2:10.65,y2:15.11}),Q=function(e){var t=e.svgRef,n=e.title,a=X(e,["svgRef","title"]);return r.a.createElement("svg",F({width:30.04,height:30.04,viewBox:"0 0 30.04 30.04",ref:t},a),J,void 0===n?U:n?r.a.createElement("title",null,n):null,z,q,Z,V,$,K)},Y=r.a.forwardRef((function(e,t){return r.a.createElement(Q,F({svgRef:t},e))})),ee=(n.p,function(e){var t=e.gameDataReceived,n=e.disableBackButton,i=function(e){if(window.hasOwnProperty("webkit")&&window.webkit.hasOwnProperty("messageHandlers")){var t=JSON.stringify(e);webkit.messageHandlers.cordova_iab.postMessage(t)}else window.parent.postMessage(e,"*")};return Object(a.useEffect)((function(){window.setGameData=function(e){i({type:"setGameData",data:e})},window.GAMEDATA=null,window.getGameData=function(){return window.GAMEDATA},window.addEventListener("message",(function(e){e.data.hasOwnProperty("userId")&&(window.GAMEDATA=e.data,t(e.data))}),!1)}),[t]),!0===n?null:r.a.createElement("div",{className:"close"},r.a.createElement(Y,{onClick:function(){i({type:"exit"})}}))}),te=n(58),ne=(n(53),function(e){return r.a.createElement("div",{className:"finder-box"},"".concat(e.content.instruction," (").concat(e.content.situations.length-e.foundSituations.length,")"))}),ae=(n(54),function(e){var t=e.onClose,n=e.content,i=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e;null===i||void 0===i||null===(e=i.current)||void 0===e||e.addEventListener("load",(function(){var e,t;null===i||void 0===i||null===(e=i.current)||void 0===e||null===(t=e.contentWindow)||void 0===t||t.postMessage(n.data,"*")}),!0),window.addEventListener("message",(function(e){switch(e.data.type){case"setGameData":break;case"exit":t&&t()}}),!0)}),[n.data,t]),r.a.createElement("iframe",{src:n.url,ref:i,title:n.url,className:"iframe-content"})});n(55);function re(){return(re=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function ie(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var oe=r.a.createElement("style",{type:"text/css"},"\n\t.st0{fill:none;stroke:#3FA548;stroke-width:32;}\n"),ce=r.a.createElement("defs",null),le=r.a.createElement("g",{id:"Page-1"},r.a.createElement("polyline",{id:"checkmark",className:"st0",points:"11.33,88.97 88.95,166.87 244.67,11.32  "})),ue=function(e){var t=e.svgRef,n=e.title,a=ie(e,["svgRef","title"]);return r.a.createElement("svg",re({id:"m-check-mark",x:"0px",y:"0px",width:"255.97px",height:"189.51px",viewBox:"0 0 255.97 189.51",style:{enableBackground:"new 0 0 255.97 189.51"},xmlSpace:"preserve",ref:t},a),n?r.a.createElement("title",null,n):null,oe,ce,le)},se=r.a.forwardRef((function(e,t){return r.a.createElement(ue,re({svgRef:t},e))})),fe=(n.p,function(e){var t=e.scenarios,n=Object.keys(t);return r.a.createElement("div",{className:"scenarios-box"},r.a.createElement("ul",null,n.map((function(n,a){return function(n,a){var i=t[n];return void 0===e.solvedScenarios[a]?r.a.createElement("li",{className:"",onClick:function(){},key:n},i.title):r.a.createElement("li",{className:"completed",key:n},r.a.createElement(se,{className:"check"}),i.title)}(n,a)}))))});te.a.registerPIXI(PIXI),S.a.registerPlugin(te.a);var de=function(){var e=Object(a.useState)(),t=Object(l.a)(e,2),n=(t[0],t[1],Object(a.useState)()),i=Object(l.a)(n,2),o=i[0],u=i[1],s=Object(a.useState)([]),f=Object(l.a)(s,2),d=f[0],m=f[1],v=Object(a.useState)(),p=Object(l.a)(v,2),h=p[0],g=p[1],w=[],b=function(e){u(e.content)};return Object(a.useEffect)((function(){var e=setTimeout((function(){window.GAME_DATA||(console.log("no bridge found, fetching fallback"),fetch("".concat("/vca","/config/data.json")).then((function(e){e.json().then((function(e){b(e)}))})))}),300);return function(){clearTimeout(e)}}),[]),Object(a.useEffect)((function(){var e;return(null===o||void 0===o?void 0:o.finder)&&d.length===o.finder.situations.length&&(e=setTimeout(g,1e3,o.finder.final)),function(){clearTimeout(e)}}),[o,d]),r.a.createElement("div",{className:"App"},r.a.createElement(ee,{gameDataReceived:b,disableBackButton:!!h}),o&&r.a.createElement(W,{content:o,onSituationClick:function(e){-1===d.indexOf(e)&&m([].concat(Object(c.a)(d),[e]))},foundSituations:d,solvedScenarios:w,onScenarioClick:function(e){console.log(e)}}),(null===o||void 0===o?void 0:o.finder)&&r.a.createElement(ne,{content:o.finder,foundSituations:d}),(null===o||void 0===o?void 0:o.scenarios)&&r.a.createElement(fe,{scenarios:o.scenarios,solvedScenarios:w}),h&&r.a.createElement(ae,{content:h,onClose:function(){g(void 0)}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(de,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[33,1,2]]]);
//# sourceMappingURL=main.38781680.chunk.js.map
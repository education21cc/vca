(this.webpackJsonpvca=this.webpackJsonpvca||[]).push([[0],{32:function(e){e.exports=JSON.parse('{"alpha":{"start":0.25,"end":0},"scale":{"start":0.04,"end":0.29,"minimumScaleMultiplier":1},"color":{"start":"#85888d","end":"#100f0c"},"speed":{"start":100,"end":200,"minimumSpeedMultiplier":1},"acceleration":{"x":10,"y":-30},"maxSpeed":200,"startRotation":{"min":265,"max":270},"noRotation":false,"rotationSpeed":{"min":8,"max":0},"lifetime":{"min":0.5,"max":3.05},"blendMode":"normal","frequency":0.0005,"emitterLifetime":-1,"maxParticles":300,"pos":{"x":0,"y":0},"addAtBack":true,"spawnType":"point"}')},36:function(e,t,n){e.exports=n(68)},41:function(e,t,n){},42:function(e,t,n){},66:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(18),i=n.n(o),c=(n(41),n(7)),l=(n(42),n(19),n(29),n(0));var s,u,f,d=function(e,t){var n=l.Loader.shared;n.resources[e]?t(n.resources[e]):n.add(e).load((function(n,a){t(a[e])}))},m=n(4);!function(e){e.tilelayer="tilelayer",e.objectgroup="objectgroup"}(s||(s={})),function(e){e.orthagonal="orthagonal",e.isometric="isometric",e.staggered="staggered",e.hexagonal="hexagonal"}(u||(u={})),function(e){e.rightUp="right-up",e.rightDown="right-down",e.leftUp="left-up",e.leftDown="left-down"}(f||(f={}));var p=n(15),v=n(21),h=function(e){var t=Object(a.useState)({}),n=Object(c.a)(t,2),r=n[0],o=n[1],i=Object(a.useState)(),l=Object(c.a)(i,2),s=l[0],u=l[1];return Object(a.useEffect)((function(){if(s){var t=g(s,r);if(t){var n=t.name,a=e(t);d("".concat(a),(function(e){if(e.error)throw new Error("Loading ".concat(a,"\n").concat(e.error));var t=Object(v.a)(Object(v.a)({},r),{},Object(p.a)({},n,e));o(t)}))}}}),[s,e,r]),{loadComplete:!!s&&void 0===g(s,r),loadTilesets:function(e){u(e)},tilesetsTextures:r}},g=function(e,t){return e.find((function(e){return!t[e.name]}))},w=n(31),b=Object(a.forwardRef)((function(e,t){var n=Object(m.useApp)();return window.PIXI=l,r.a.createElement(y,Object.assign({app:n},e,{ref:t}))})),y=Object(m.PixiComponent)("Viewport",{create:function(e){var t=new w.a({screenWidth:e.screenWidth,screenHeight:e.screenHeight,worldWidth:e.worldWidth,worldHeight:e.worldHeight,ticker:e.app.ticker});t.on("clicked",(function(t){e.onClick&&e.onClick(t)}));var n=e.minScale,a=void 0===n?.3:n,r=e.maxScale,o=void 0===r?1:r;return t.drag().pinch().wheel().clamp({direction:"all"}).setZoom(.4).clampZoom({minScale:a,maxScale:o}).decelerate(),t}}),E=b,O=function(e,t,n){var a=x(t,n)+64*e[0]+64*-e[1],r=64*(e[0]+e[1])/2+64+128;return new l.Point(a,r)},x=function(e,t){return 32*(t-e)+128*(t+e)/2/2};window.PIXI=l,n(54);var j=Object(m.PixiComponent)("FloorTileLayer",{create:function(e){return new window.PIXI.tilemap.CompositeRectTileLayer(0,[e.texture])},applyProps:function(e,t,n){var a=n.layer,r=n.tileset,o=n.verticalTiles,i=n.horizontalTiles,c=n.spritesheet;if(a.data)for(var l=function(t){if(a.data[t]>0){var n=[t%i,Math.floor(t/i)],l=O(n,i,o),s=r.tiles.find((function(e){return e.id===a.data[t]-r.firstgid})),u=null===s||void 0===s?void 0:s.image.substr((null===s||void 0===s?void 0:s.image.lastIndexOf("/"))+1);e.addFrame(c.textures[u],l.x-64,l.y-64)}},s=0;s<a.data.length;s++)l(s)}}),k=n(32),C=n(35),S=n(33),P=Object(m.PixiComponent)("ParticleEmitter",{create:function(){return new l.ParticleContainer},applyProps:function(e,t,n){var a=n.image,r=n.config,o=Object(C.a)(n,["image","config"]);Object(m.applyDefaultProps)(e,t,o);var i=this._emitter;if(!i){i=new S.a(e,[l.Texture.from(a)],r);var c=performance.now();i.emit=!0,function e(){i.raf=requestAnimationFrame(e);var t=performance.now();i.update(3e-4*(t-c)),c=t}()}this._emitter=i},willUnmount:function(){this._emitter&&(this._emitter.emit=!1,cancelAnimationFrame(this._emitter.raf))}}),N=function(e){var t=e.x,n=void 0===t?0:t,a=e.y,o=void 0===a?0:a;return r.a.createElement(P,{name:"smoke",x:n,y:o,image:"".concat("/vca","/effects/smokeparticle.png"),config:k,pivot:[-64,0]})},A=window.innerWidth,T=window.innerHeight;var M=function(e){var t=e.jsonPath,n=e.onSituationClick,o=Object(a.useState)(),i=Object(c.a)(o,2),u=i[0],f=i[1];l.settings.ROUND_PIXELS=!0;var p=h(D),v=p.loadComplete,g=p.loadTilesets,w=p.tilesetsTextures;Object(a.useEffect)((function(){l.settings.SCALE_MODE=l.SCALE_MODES.NEAREST,d("".concat("/vca","/").concat(t),(function(e){f(e.data)}))}),[t]),Object(a.useEffect)((function(){u&&g(u.tilesets)}),[g,u]);var b=64*(((null===u||void 0===u?void 0:u.width)||1)+((null===u||void 0===u?void 0:u.height)||1)),y=32*(((null===u||void 0===u?void 0:u.width)||1)+((null===u||void 0===u?void 0:u.height)||1))+128,x=Object(a.useRef)(null);if(Object(a.useEffect)((function(){x.current&&x.current.moveCenter(b/2,y/2)}),[u,y,b,w]),!v||!u)return r.a.createElement("div",null,"Loading...");var k=function(e,t,n){return e.map((function(e,a){var o=536870911&e,i=R(o,u.tilesets);if(!i||!i.tiles||0===e)return null;var l=u.width,s=a%l,f=Math.floor(a/l),d=0!==(1073741824&e),p=[1,1];0!==(2147483648&e)&&(p[0]*=-1),d&&(p[1]*=-1);var v=i.tiles.find((function(e){return e.id===o-i.firstgid}));if(!v)return null;var h=v.image.split("/"),g=Object(c.a)(h,3),b=(g[0],g[1]),y=g[2];return w[b]||console.warn("Could not find spritesheet ".concat(b," ").concat(w)),w[b].textures[y]||console.warn("Could not find texture ".concat(b," ").concat(y)),r.a.createElement(m.Sprite,{key:a,name:"".concat(t.name,": ").concat(s,",").concat(f," (").concat(y,")"),scale:p,texture:w[b].textures[y],anchor:[0,1],pivot:[64,0],position:O([s,f],u.width,u.height),zIndex:100*a+n})}))},C=function(e){return e.map((function(e,t){if(e.polygon){var a=[e.x/64,e.y/64],o=e.polygon.reduce((function(e,t){return e.push(t.y+t.x),e.push(t.y/2-t.x/2),e}),[]);return r.a.createElement(m.Graphics,{key:"".concat(e.type).concat(e.name).concat(t),draw:function(e){e.beginFill(12245589),e.drawPolygon(o),e.endFill()},position:O(a,u.width,u.height),pivot:[64,32]})}if(e.gid){var i=e.x,l=e.y,s=e.gid,f=[i/64-1,l/64-1],d=536870911&s,p=R(d,u.tilesets);if(!p||!p.tiles||0===s)return null;var v=0!==(1073741824&s),h=[1,1];0!==(2147483648&s)&&(h[0]*=-1),v&&(h[1]*=-1);var g=p.tiles.find((function(e){return e.id===d-p.firstgid}));if(!g)return null;var b=g.image.split("/"),y=Object(c.a)(b,3),E=(y[0],y[1]),x=y[2];return w[E]||console.warn("Could not find spritesheet ".concat(E," ").concat(w)),w[E].textures[x]||console.warn("Could not find texture ".concat(E," ").concat(x)),r.a.createElement(m.Sprite,{key:"".concat(e.type).concat(e.name).concat(t),name:"".concat(e.name,": ").concat(i,",").concat(l," (").concat(x,")"),scale:h,texture:w[E].textures[x],anchor:[0,1],pivot:[64,0],position:O(f,u.width,u.height),pointerdown:function(){return n(e.name)},interactive:!!e.name},S(e.properties))}return null}))},S=function(e){if(!e)return null;var t,n,a=e.find((function(e){return"offset"===e.name}));if(a){var o=a.value.split(","),i=Object(c.a)(o,2);t=i[0],n=i[1]}return r.a.createElement(N,{x:t,y:n})},P={sharedLoader:!0,backgroundColor:I(null===u||void 0===u?void 0:u.backgroundcolor)};return r.a.createElement(m.Stage,{width:A,height:T,className:"background",options:P},r.a.createElement(E,{worldWidth:b,worldHeight:y,screenWidth:A,screenHeight:T,ref:x},function(e){if(!e)return console.warn("No layer with name 'floor' found!"),null;var t=L(e).find(Boolean);if(!t)return console.warn("Layer with name 'floor' is empty?"),null;var n=R(536870911&t,u.tilesets);if(!n)return console.warn("No tileset found for floor layer. Huh?"),null;var a=w[n.name];return l.utils.clearTextureCache(),a.spritesheet?r.a.createElement(j,{texture:a.spritesheet._texture,verticalTiles:u.height,horizontalTiles:u.width,layer:e,tileset:n,spritesheet:a.spritesheet}):(console.warn("No texture loaded found for floor layer. Was looking for ".concat(n.name)),null)}(u.layers.find((function(e){return"floor"===e.name}))),r.a.createElement(m.Container,{sortableChildren:!0},u.layers.filter((function(e){return e.visible&&"floor"!==e.name&&e.type===s.tilelayer})).map((function(e,t){var n=L(e);return k(n,e,t)}))),function(e){return e.filter((function(e){return e.visible&&e.type===s.objectgroup})).map((function(e,t){return C(e.objects)}))}(u.layers)))},D=function(e){return"".concat("/vca","/maps/tilesets/").concat(e.name,".json")},R=function(e,t){for(var n,a=t.length-1;a>=0&&!((n=t[a]).firstgid<=e);a--);return n},I=function(e){if(e)return parseInt(e.substring(1),16)},L=function(e){var t=e.data;return"string"!==typeof t?t:(e.encoding,e.compression,[])},H=n(34),W=n.n(H),_=(n(66),function(e){var t=e.onClose,n=e.situation,a=function(){t()};return r.a.createElement(W.a,{isOpen:!0,ariaHideApp:!1,portalClassName:"modal-portal",overlayClassName:"modal-overlay",className:"modal",onRequestClose:a},r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"header"},r.a.createElement("h1",null,n.title," "),r.a.createElement("div",{className:"modal-close",onClick:function(){return a()}})),r.a.createElement("iframe",{src:n.url,title:"game"})))});n(67);function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function G(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var B=r.a.createElement("defs",null,r.a.createElement("style",null,".a{fill:#fff;}.a,.b{stroke:#283583;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.75px;}.b{fill:none;}")),J=r.a.createElement("title",null,"Back"),U=r.a.createElement("circle",{className:"a",cx:15.02,cy:15.02,r:14.65}),X=r.a.createElement("path",{className:"b",d:"M11.64,16",transform:"translate(-0.97 -0.93)"}),q=r.a.createElement("path",{className:"b",d:"M11.63,16",transform:"translate(-0.97 -0.93)"}),z=r.a.createElement("path",{className:"b",d:"M20.38,22.88",transform:"translate(-0.97 -0.93)"}),Z=r.a.createElement("line",{className:"b",x1:19.39,y1:8.16,x2:10.65,y2:15.02}),V=r.a.createElement("line",{className:"b",x1:19.39,y1:21.98,x2:10.65,y2:15.11}),$=function(e){var t=e.svgRef,n=e.title,a=G(e,["svgRef","title"]);return r.a.createElement("svg",F({width:30.04,height:30.04,viewBox:"0 0 30.04 30.04",ref:t},a),B,void 0===n?J:n?r.a.createElement("title",null,n):null,U,X,q,z,Z,V)},K=r.a.forwardRef((function(e,t){return r.a.createElement($,F({svgRef:t},e))})),Q=(n.p,function(e){var t=e.gameDataReceived,n=function(e){if(window.hasOwnProperty("webkit")&&window.webkit.hasOwnProperty("messageHandlers")){var t=JSON.stringify(e);webkit.messageHandlers.cordova_iab.postMessage(t)}else window.parent.postMessage(e,"*")};return Object(a.useEffect)((function(){window.setGameData=function(e){n({type:"setGameData",data:e})},window.GAMEDATA=null,window.getGameData=function(){return window.GAMEDATA},window.addEventListener("message",(function(e){e.data.hasOwnProperty("userId")&&(window.GAMEDATA=e.data,t(e.data))}),!1)}),[t]),r.a.createElement("div",{className:"close"},r.a.createElement(K,{onClick:function(){n({type:"exit"})}}))});var Y=function(){var e=Object(a.useState)(),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(),l=Object(c.a)(i,2),s=l[0],u=l[1],f=Object(a.useState)(),d=Object(c.a)(f,2),m=d[0],p=d[1];return Object(a.useEffect)((function(){}),[]),r.a.createElement("div",{className:"App"},r.a.createElement(Q,{gameDataReceived:function(e){o(e.content.mapJson),p(e.content)}}),r.a.createElement("select",{value:n,onChange:function(e){return o(e.currentTarget.value)}},r.a.createElement("option",null,"maps/testmap1.json"),r.a.createElement("option",null,"maps/testmap2.json"),r.a.createElement("option",null,"maps/testmap3.json"),r.a.createElement("option",null,"maps/testmap4.json")),s&&r.a.createElement(_,{onClose:function(){u(void 0)},situation:s}),n&&r.a.createElement(M,{jsonPath:n,onSituationClick:function(e){u(m.situations[e])}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[36,1,2]]]);
//# sourceMappingURL=main.499b5837.chunk.js.map
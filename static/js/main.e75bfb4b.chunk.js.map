{"version":3,"sources":["utils/tiledMapData.ts","components/pixi/Viewport.tsx","constants/tiles.ts","utils/isometric.ts","components/pixi/FloorTileLayer.tsx","components/pixi/Marker.tsx","utils/tiles.ts","components/pixi/ParticleEmitter.ts","components/pixi/effects/smoke1/index.tsx","components/pixi/SpriteAnimated.tsx","components/pixi/MapObject.tsx","components/pixi/Map/index.tsx","components/playerBridge/style/close.svg","components/ScenarioScreen/styles/back.svg","components/playerBridge/index.tsx","components/FinderBox/index.tsx","components/IFrameModal/index.tsx","components/ScenariosBox/index.tsx","components/ScenarioScreen/Reactions.tsx","components/ScenarioScreen/FeedbackTitle.tsx","components/ScenarioScreen/styles/close.svg","components/ScenarioScreen/index.tsx","common/images/star-empty.svg","components/playerBridge/Loading/index.tsx","components/dialogs/BaseDialog.tsx","components/dialogs/IntroDialog.tsx","utils/pixiJs.ts","common/images/star-full.svg","hooks/useTilesetsLoader.ts","App.tsx","components/dialogs/CompleteDialog.tsx","serviceWorker.ts","index.tsx"],"names":["TiledLayerType","Orientation","RenderOrder","Viewport","forwardRef","props","ref","app","useApp","PixiComponentViewport","PixiComponent","create","viewport","PixiViewport","screenWidth","screenHeight","worldWidth","worldHeight","ticker","minScale","maxScale","drag","pinch","wheel","clamp","direction","setZoom","clampZoom","decelerate","TILE_WIDTH","TILE_HEIGHT","tileLocationToPosition","location","horizontalTiles","verticalTiles","x","getOriginX","y","PIXI","getTileIndex","FloorTileLayer","CompositeRectTileLayer","texture","applyProps","instance","oldProps","layer","tileset","spritesheet","data","i","Math","floor","position","tile","tiles","find","t","id","firstgid","tileName","image","substr","lastIndexOf","addFrame","textures","length","Marker","useRef","useState","bounce","process","useEffect","gsap","from","current","duration","ease","pixi","visible","scale","delay","bounceAnim","to","yoyo","repeat","random","kill","onDragStart","event","onDragEnd","undefined","onDragMove","anchor","interactive","mousedown","touchstart","mouseup","mouseupoutside","mousemove","touchmove","findTileset","gid","tilesets","ParticleEmitter","ParticleContainer","newProps","config","newP","applyDefaultProps","emitter","this","_emitter","particles","elapsed","performance","now","emit","tick","raf","requestAnimationFrame","update","willUnmount","cancelAnimationFrame","Smoke1","name","smoke","pivot","SpriteAnimated","PixiComponentSpriteAnimated","gotoAndStop","currentFrame","memo","MapObject","o","mapData","tilesetsTextures","found","onClick","checkRef","spritesheetTextures","timeout","tl","animation","properties","p","type","value","steps","JSON","parse","e","Error","animSpritesheet","parseFloat","timeline","lastStep","currentStep","distance","sqrt","pow","width","height","speed","onStart","set","onUpdate","zIndex","Linear","easeNone","setTimeout","flash","clearTimeout","clear","polygon","points","reduce","acc","push","draw","graphics","beginFill","drawPolygon","endFill","actualGid","flipVert","split","textureName","console","warn","filter","map","td","str","pointerdown","renderEffects","offset","effect","_defs","_circle","_path","_path2","_path3","_line","_line2","Map","content","foundSituations","onSituationClick","window","innerWidth","setScreenWidth","innerHeight","setScreenHeight","mapWidth","mapHeight","viewportRef","moveCenter","finder","sound","add","url","autoPlay","resize","addEventListener","removeEventListener","layers","renderLayerTiles","tileData","layerIndex","columns","renderObjects","objects","index","indexOf","renderScenarioMarker","scenario","solvedScenarios","pointertap","onScenarioClick","handleMarkerClick","options","sharedLoader","backgroundColor","parseBackgroundColor","backgroundcolor","className","firstTileGid","getTiles","Boolean","resource","clearTextureCache","_texture","renderFloor","l","sortableChildren","tilelayer","objectgroup","renderObjectLayers","Object","entries","scenarios","key","asString","parseInt","substring","rawData","encoding","compression","_extends","assign","target","arguments","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgClose","_ref","svgRef","title","titleId","xmlns","viewBox","cx","cy","r","d","transform","x1","y1","x2","y2","ForwardRef","PlayerBridge","gameDataReceived","disableBackButton","interval","setInterval","GAMEDATA","clearInterval","setGameData","gameData","send","exit","getGameData","payload","webkit","stringifiedMessageObj","stringify","messageHandlers","cordova_iab","postMessage","parent","FinderBox","disabled","situations","instructionText","onOpenGame","nextText","IFrameModal","onBack","onSetGameData","contentWindow","src","open","ScenarioBox","scenariosNames","onComplete","Reactions","reactions","onSelect","selected","texts","FeedbackTitle","correct","SvgBack","_style","xmlnsXlink","style","enableBackground","xmlSpace","State","registerPlugin","TextPlugin","ScenarioScreen","reopeningCorrectScenario","selectedReaction","description","state","setState","setImage","setSelectedReaction","handleGoToDescription","querySelector","scroll","top","left","behavior","selectedReactionText","useMemo","selectedReactionCorrect","handleHotspotClick","tagName","path","getAttribute","imageUrl","parseUrl","startsWith","feedback","imageFeedback","alt","hotspots","h","data-img","hotspot","play","setCorrectReaction","Loading","BaseDialog","children","SvgStarEmpty","IntroDialog","headerText","descriptionText","starsToGainText","startText","loadResource","callback","loader","Loader","shared","resources","load","_","useTilesetsLoader","determineTilesetSpritesheetPath","setTilesets","setData","loadTilesets","useCallback","nextTileset","nextTilesetToload","tilesetName","error","newTilesets","loadComplete","SvgStarFull","GameState","CompleteDialog","total","mistakes","score","max","setLevelScore","scoreText","replace","toString","result","renderStars","onTryAgain","tryAgainText","onExit","exitText","PixiPlugin","registerPIXI","App","intro","translations","setTranslations","setMapData","setScenario","setFoundSituations","scenarioReactions","setScenarioReactions","iframeOpen","setIframeOpen","handleBack","handleSetGameData","handleGameDataReceived","translation","levelsCompleted","jsonPath","mapJson","iframe","final","handleStart","normal","currentScore","maxScore","stars","situation","complete","level","reaction","tilesetData","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.e75bfb4b.chunk.js","sourcesContent":["export interface TiledMapData {\n    width: number;\n    height: number;\n    tilewidth: number;\n    tileheight: number;\n    infinite: boolean;\n    backgroundcolor?: string;\n    orientation: Orientation;\n    renderorder: RenderOrder;\n    tilesets: TiledTilesetData[];\n    layers: TiledLayerData[];\n}\n\nexport interface TiledTilesetData {\n    columns: number;\n    firstgid: number;\n    source: string;\n    image: string;\n    imagewidth: number;\n    imageheight: number;\n    tilewidth: number;\n    tileheight: number;\n    tilecount: number;\n    name: string;\n    margin: number; // todo:\n    spacing: number; // todo\n    tiles?: TileData[];\n}\n\nexport interface TileData {\n    id: number,\n    image: string;\n    type?: string;\n    properties?: TiledProperty[];\n}\n\nexport interface TiledLayerData {\n    data: number[] | string;\n    objects: TiledObjectData[];\n    type: TiledLayerType;\n    height: number;\n    id: number;\n    name: string;\n    opacity: number; // not supported atm\n    visible: boolean;\n    x: number;\n    y: number;\n    width: number;\n    properties?: TiledProperty[];\n    encoding?: 'base64';\n    compression?: '' | 'gzip' | 'zstd';\n}\n\nexport interface TiledObjectData {\n    gid?: number;\n    id: number;\n    name: string;\n    properties?: TiledProperty[];\n    polygon?: { x: number, y: number}[];\n    type: string;\n    visible: boolean;\n    width: number;\n    height: number;\n    x: number;\n    y: number;\n}\n\nexport enum TiledLayerType {\n    tilelayer = \"tilelayer\",\n    objectgroup = \"objectgroup\"\n}\n\nexport interface TiledProperty {\n    name: string,\n    type: string,\n    value: any\n}\n\nenum Orientation {\n    orthagonal = \"orthagonal\",\n    isometric = \"isometric\",\n    staggered = \"staggered\",\n    hexagonal = \"hexagonal\"\n}\n\nenum RenderOrder {\n    rightUp = \"right-up\",\n    rightDown = \"right-down\",\n    leftUp = \"left-up\",\n    leftDown = \"left-down\"\n}","import React, { forwardRef } from \"react\";\nimport { Viewport as PixiViewport, ClickEventData } from \"pixi-viewport\";\nimport { PixiComponent, useApp } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport { InteractionEvent } from \"pixi.js\";\n\ninterface Props {\n  onClick?(event: InteractionEvent): void;\n  screenWidth: number,\n  screenHeight: number,\n  worldWidth: number,\n  worldHeight: number,\n  minScale?: number;\n  maxScale?: number;\n}\n\n/** Viewport leverages pixi-viewport to create a pannable map\n * https://davidfig.github.io/pixi-viewport/jsdoc/\n */\nconst Viewport = forwardRef<PixiViewport, any>((props, ref) => {\n  const app = useApp();\n\n  return <PixiComponentViewport app={app} {...props} ref={ref} />;\n});\n\ninterface PixiComponentProps {\n    app: PIXI.Application;\n}\n\nconst PixiComponentViewport = PixiComponent(\"Viewport\", {\n  // @ts-ignore\n  create: (props: PixiComponentProps & Props) => {\n    const viewport = new PixiViewport({\n      screenWidth: props.screenWidth,\n      screenHeight: props.screenHeight,\n      worldWidth: props.worldWidth,\n      worldHeight: props.worldHeight,\n      ticker: props.app.ticker,\n      //interaction: props.app.renderer.plugins.interaction,\n      // the interaction module is important for wheel to work properly when renderer.view is placed or scaled\n    });\n    // viewport.on(\"clicked\", (event) => { if(props.onClick) props.onClick(event) });\n\n    const {\n      minScale = .15,\n      maxScale = 1\n    } = props;\n\n    viewport\n      .drag()\n      .pinch()\n      .wheel()\n      .clamp({ direction: 'all' })\n      .setZoom(.15)\n      .clampZoom({ minScale, maxScale })\n      .decelerate();\n\n    return viewport;\n  }\n});\nexport default Viewport;\n","export const TILE_WIDTH = 128;\nexport const TILE_HEIGHT = 64;\nexport const MARGIN_TOP = 128;   // extra top margin around the map\n","import * as PIXI from 'pixi.js';\nimport { TILE_WIDTH, TILE_HEIGHT, MARGIN_TOP } from \"constants/tiles\";\n\nexport const tileLocationToPosition = (location: [number, number], horizontalTiles: number, verticalTiles: number) => {\n  const x = getOriginX(horizontalTiles, verticalTiles) + (TILE_WIDTH / 2) * location[0] + (TILE_WIDTH / 2) * -location[1];\n  const y = (location[0] + location[1]) * TILE_HEIGHT / 2 + (TILE_HEIGHT) + MARGIN_TOP;\n  return new PIXI.Point(x, y);\n}\n\n/** x coordinate (pixel space) of the top of the tile with location [0, 0] */\nexport const getOriginX = (horizontalTiles: number, verticalTiles: number) => {\n  return (verticalTiles - horizontalTiles) * (TILE_HEIGHT / 2) + ((verticalTiles + horizontalTiles) * TILE_WIDTH / 2) / 2;\n}\n\n/** returns the tile index if the tiles were numbered going right-down */\nexport const getTileIndex = (location: [number, number], horizontalTiles: number) => {\n  return  horizontalTiles * location[1] + location[0];\n}","import { PixiComponent } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport { TiledLayerData, TiledTilesetData } from \"utils/tiledMapData\";\nimport { tileLocationToPosition } from \"utils/isometric\";\nimport { TILE_HEIGHT, TILE_WIDTH } from \"constants/tiles\";\nimport { CompositeRectTileLayer } from \"@pixi/tilemap\"\n\ninterface Props  {\n  texture: PIXI.Texture;\n  verticalTiles: number;\n  horizontalTiles: number;\n  layer: TiledLayerData;\n  tileset: TiledTilesetData;\n  spritesheet: PIXI.Spritesheet;\n};\n\n// Floortile layer leverages pixi-tilemap for better performance\nconst FloorTileLayer = PixiComponent<Props, any>(\"FloorTileLayer\", {\n  create(props: Props) {\n\n    // @ts-ignore\n    const tileLayer = new CompositeRectTileLayer(0, [props.texture]);\n    return tileLayer;\n  },\n\n  applyProps(instance, oldProps: Props, props: Props) {\n    const {layer, tileset, verticalTiles, horizontalTiles, spritesheet } = props;\n    if (!layer.data) {\n      return;\n    }\n    for (let i = 0; i < layer.data.length; i++) {\n      if (layer.data[i] > 0) {\n        const location: [number, number] = [i % horizontalTiles, Math.floor(i / horizontalTiles)];\n        const position = tileLocationToPosition(location, horizontalTiles, verticalTiles);\n\n        // @ts-ignore\n        const tile = tileset.tiles!.find((t) => t.id === layer.data[i] - tileset.firstgid);\n        const tileName = tile?.image.substr(tile?.image.lastIndexOf('/') + 1);\n        \n        instance.addFrame(spritesheet.textures[tileName!], \n          position.x - TILE_WIDTH / 2, \n          position.y - TILE_HEIGHT);\n      }\n    }\n  }\n});\n\nexport default FloorTileLayer;\n\n","import React, { useRef, useEffect, useState, ComponentProps } from 'react';\nimport { Sprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\nimport { gsap } from 'gsap'\n\n\nconst CAN_DRAG = false;\ninterface Props {\n    position?: PIXI.Point;\n    delay?: number; // Wait this long before showing\n    bounce?: boolean;\n}\n\n/* A map marker (the red or green arrow thimg) */\nconst Marker = (props: Props & ComponentProps<typeof Sprite>) => {\n    const ref = useRef<PIXI.Sprite>(null);\n    const data = useRef<PIXI.InteractionData>();\n    const [position, setPosition] = useState<PIXI.Point>(props.position || new PIXI.Point());\n    const popInDuration = 1;\n    const image = props.bounce ? `${process.env.PUBLIC_URL}/images/ui/marker-red.svg` :  `${process.env.PUBLIC_URL}/images/ui/marker-green.svg`;\n\n    useEffect(() => {\n        // Pop in animation!\n        gsap.from(ref.current, { \n          duration: popInDuration,\n          ease: \"elastic.out(2, 0.5)\",\n          pixi: { \n            visible: false,\n            scale: .1, \n          }\n        }).delay(props.delay || 0);\n    }, [props.delay]);\n\n    useEffect(() => {\n        let bounceAnim: gsap.core.Tween;\n        // Bounce animation!\n        if (props.bounce !== false) {\n            bounceAnim = gsap.to(ref.current, { \n                duration: .5,\n                yoyo: true,\n                repeat: -1,\n                pixi: { \n                  //@ts-ignore\n                    y: '-=40', \n                }\n              }).delay(popInDuration + Math.random());      \n        }\n        return () => {\n            bounceAnim?.kill();\n        }\n    }, [props.bounce]);\n\n    const onDragStart = (event: PIXI.InteractionEvent) => {\n        if (!CAN_DRAG) return;\n        // store a reference to the data\n        // the reason for this is because of multitouch\n        // we want to track the movement of this particular touch\n        data.current = event.data;\n        event.stopPropagation(); // Stop dragging the map!\n    }\n    \n    const onDragEnd = () => {\n        data.current = undefined;\n    }\n    \n    const onDragMove = () => {\n        if (!CAN_DRAG) return;\n        if (data.current)\n        {\n            const newPosition = data.current.getLocalPosition(ref.current!.parent);\n            setPosition(newPosition);\n        }\n    }\n    \n    return (\n        <Sprite \n            { ...props }\n            anchor={[0.5, 0.5]}\n            position={position}\n            ref={ref}\n            interactive={true}\n            image={image}\n            mousedown={onDragStart}\n            touchstart={onDragStart}\n            mouseup={onDragEnd}\n            mouseupoutside={onDragEnd}\n            mousemove={onDragMove}\n            touchmove={onDragMove}\n        />\n    );\n}\n\nexport default Marker;","import { TiledTilesetData } from \"./tiledMapData\";\n\n// finds tileset based on gid\nexport const findTileset = (gid: number, tilesets: TiledTilesetData[]) => {\n    let tileset;\n    for (let i = tilesets.length - 1; i >= 0; i--) {\n      tileset = tilesets[i];\n      if (tileset.firstgid <= gid) {\n        break;\n      }\n    }\n    return tileset;\n  }\n  ","import { PixiComponent, applyDefaultProps, Container } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport * as particles from 'pixi-particles';\nimport { ParticleContainer } from \"pixi.js\";\n\ninterface Props  {\n    image: string;\n    config: particles.OldEmitterConfig | particles.EmitterConfig;\n};\n\nconst ParticleEmitter = PixiComponent<Props & React.ComponentProps<typeof Container>, ParticleContainer>(\"ParticleEmitter\", {\n    create() {\n      return new ParticleContainer(255, {});\n    },\n\n    applyProps(instance, oldProps: Props, newProps: Props) {\n      const { image, config, ...newP } = newProps;\n\n      // apply rest props to PIXI.ParticleContainer\n      applyDefaultProps(instance, oldProps, newP);\n\n      let emitter = (this as any)._emitter;\n      if (!emitter) {\n        emitter = new particles.Emitter(\n          instance,\n          [PIXI.Texture.from(image)],\n          config\n        );\n\n        let elapsed = performance.now();\n\n        const tick = () => {\n          emitter.raf = requestAnimationFrame(tick);\n          const now = performance.now();\n          // const amp = Math.random() * 5 + 15;\n          // const amp = 15;\n          // const freq = 0.0015;\n          // emitter.acceleration.x = (Math.sin((elapsed * freq)) * amp) + 15;\n\n          emitter.update((now - elapsed) * 0.0003);\n\n          elapsed = now;\n        };\n        emitter.emit = true;\n        // emitter.update(00.2);\n\n        tick();\n      }\n      (this as any)._emitter = emitter;\n    },\n\n    willUnmount() {\n      if ((this as any)._emitter) {\n        (this as any)._emitter.emit = false;\n        cancelAnimationFrame((this as any)._emitter.raf);\n      }\n    }\n});\n\nexport default ParticleEmitter;","import React from \"react\";\nimport smoke from './smoke.json';\nimport ParticleEmitter from 'components/pixi/ParticleEmitter';\nimport { TILE_WIDTH } from \"constants/tiles\";\nimport { Container } from \"@inlet/react-pixi\";\n\n\nconst Smoke1 = (props: React.ComponentProps<typeof Container> ) => {\n    const { x = 0, y = 0 } = props;\n    return (\n        <ParticleEmitter\n            name=\"smoke\"\n            x={x}\n            y={y}\n            image={`${process.env.PUBLIC_URL}/effects/smokeparticle.png`}\n            config={smoke}\n            pivot={[-TILE_WIDTH / 2, 0]}\n        />\n    )\n}\nexport default Smoke1;","import React, { forwardRef, memo } from 'react';\nimport { PixiComponent, applyDefaultProps, AnimatedSprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\n\nconst SpriteAnimated = forwardRef<PIXI.AnimatedSprite, any>((props, ref) => {\n  return <PixiComponentSpriteAnimated {...props} ref={ref} />;\n});\n\nconst PixiComponentSpriteAnimated = PixiComponent<React.ComponentProps<typeof AnimatedSprite>, PIXI.AnimatedSprite>('SpriteAnimated', {\n  create: ({ textures }) => {\n    const animatedSprite = new PIXI.AnimatedSprite(textures || [], true);\n    return animatedSprite;\n  },\n  applyProps: (instance, oldProps, newProps) => {\n    if(oldProps.textures !== newProps.textures){\n      applyDefaultProps(instance, oldProps, newProps);\n      instance.gotoAndStop(instance.currentFrame);\n    }\n  },\n});\n\nexport default memo(SpriteAnimated);\n\n","import React, { useEffect, useRef } from 'react';\nimport { TiledObjectData, TiledProperty, TiledMapData, TiledTilesetData } from 'utils/tiledMapData';\nimport { TILE_HEIGHT, TILE_WIDTH } from 'constants/tiles';\nimport { Sprite, Graphics } from '@inlet/react-pixi';\nimport { findTileset } from 'utils/tiles';\nimport { getTileIndex, tileLocationToPosition } from 'utils/isometric';\nimport Smoke1 from './effects/smoke1';\nimport { gsap, Linear } from 'gsap'\nimport SpriteAnimated from './SpriteAnimated';\nimport { AnimatedSprite } from 'pixi.js';\n\n\ninterface Props {\n    data: TiledObjectData;\n    found?: boolean;\n    mapData: TiledMapData;\n    tilesetsTextures: {[key: string]: any};\n    onClick: (name:string) => void; \n}\n\nconst MapObject = (props: Props) => {\n  const o = props.data;\n  const {mapData, tilesetsTextures, found, onClick} = props;\n\n  const popInDuration = 1;\n  const checkRef = useRef(null);\n  const ref = useRef<AnimatedSprite>(null);\n  const tileset = useRef<TiledTilesetData>();\n  const spritesheetTextures = useRef<any>();\n\n  useEffect(() => {\n    // Pop in animation!\n    if (!checkRef.current) return;\n    gsap.from(checkRef.current, { \n      duration: popInDuration,\n      ease: \"elastic.out(2, 0.5)\",\n      pixi: { \n        visible: false,\n        scale: .1, \n      }\n    });\n  }, [found]);\n\n  useEffect(() => {\n    let timeout: NodeJS.Timeout;\n    let tl: gsap.core.Timeline;\n    if (!ref.current) return; \n\n    const animation = o.properties?.find(p => p.name === 'animation');\n    if (!animation) return;\n    \n    const type = o.properties?.find(p => p.name === 'type')?.value;\n    \n    if (type === 'move') {\n      // Pass a string like \"[[0, 22], [5, 22], [5,25], [11, 25], [11, 18]]\" with coordinates\n      let steps;\n      try {\n        steps = JSON.parse(animation.value);\n      }\n      catch (e){\n        throw new Error(`Couldn't parse animation steps: \"${animation.value}\"`);\n      }\n      // the spritheet is to show different frames for different angles. \n      // it looks for sprites with the given type in the tileset. \n      // first frame is southeast, second frame is northeasth\n      const animSpritesheet = o.properties?.find(p => p.name === 'spritesheet')?.value;\n\n      const delay = parseFloat(o.properties?.find(p => p.name === 'delay')?.value || 0);\n      tl = gsap.timeline({\n        repeat: -1,\n        delay\n      });\n      for(let i = 1; i < steps.length; i++) {\n        const lastStep = steps[i - 1];\n        const currentStep = steps[i];\n        const distance = Math.sqrt(Math.pow(currentStep[0] - lastStep[0], 2) + Math.pow(currentStep[1] - lastStep[1], 2));\n\n        ref.current.gotoAndStop(0);\n        const position = tileLocationToPosition(currentStep, mapData.width, mapData.height);\n        const speed = parseFloat(o.properties?.find(p => p.name === 'speed')?.value || 0.25);\n\n        tl.to(ref.current, {\n          onStart: () => {\n            if (animSpritesheet) {\n              // console.log('last step', lastStep)\n              // console.log('currentStep', currentStep)\n              if (lastStep[0] === currentStep[0] && lastStep[1] > currentStep[1]) {\n                // console.log('ne');\n                ref.current!.gotoAndStop(1);\n                ref.current!.scale.set(1, 1);\n              } else if (lastStep[0] > currentStep[0] && lastStep[1] === currentStep[1]){\n                // console.log('nw')\n                ref.current!.gotoAndStop(1);\n                ref.current!.scale.set(-1, 1);\n                \n              } else if (lastStep[0] === currentStep[0] && lastStep[1] < currentStep[1]){\n                // console.log('sw')\n                ref.current!.gotoAndStop(0);\n                ref.current!.scale.set(-1, 1);\n              } else {\n                // console.log('se')\n                ref.current!.gotoAndStop(0);\n                ref.current!.scale.set(1, 1);\n              }\n            }\n          },\n          onUpdate: () => {\n            if (ref.current) {\n              ref.current.zIndex = getTileIndex(currentStep, mapData.width);\n            }\n          },\n          duration: speed * distance,\n          pixi: { \n            x: position.x,\n            y: position.y,\n          },\n          ease: Linear.easeNone,\n        });\n      }\n    }\n    else if (type === 'flicker') {\n      const flash = () => {\n        ref.current!.visible = Math.random() < .5;\n        timeout = setTimeout(flash, Math.random() * 250);\n      }\n      timeout = setTimeout(flash, Math.random() * 250);\n    }\n\n    return () => {\n      clearTimeout(timeout);\n      if (tl) {\n        tl.clear();\n      }\n    }\n  }, [mapData, o.properties]);\n\n  if (o.polygon) {\n    const {x, y } = o;\n    const location: [number, number] = [\n      x / TILE_HEIGHT,\n      y / TILE_HEIGHT\n    ];\n\n    const points = o.polygon.reduce((acc: number[], value: { x: number, y: number} ) => {\n      acc.push(value.y + value.x)\n      acc.push((value.y / 2) - (value.x / 2));\n      return acc;\n    }, []);\n\n    return (\n      <Graphics\n        key={`${o.type}${o.name}`}\n        draw={graphics => {\n          graphics.beginFill(0xBADA55);\n          graphics.drawPolygon(points);\n          graphics.endFill();\n        }}\n        position={tileLocationToPosition(location, mapData.width, mapData.height)}\n        pivot={[TILE_WIDTH / 2, TILE_HEIGHT /2]}\n      />\n    )\n  }\n  else if (o.gid) {\n    // todo: DRY\n    const {x, y, gid } = o;\n    const location: [number, number] = [\n      x / TILE_HEIGHT - 1,\n      y / TILE_HEIGHT - 1\n    ];\n\n    const actualGid = gid & 0x1FFFFFFF;\n    tileset.current = findTileset(actualGid, mapData!.tilesets);\n\n    if (!tileset || !tileset.current!.tiles || gid === 0) return null;\n      \n    // See https://discourse.mapeditor.org/t/data-field-in-the-tmx-format-json/3633\n    const flipHor = (gid & 0x80000000) !== 0;\n    const flipVert = (gid & 0x40000000) !== 0;\n    const scale: [number, number] = [1, 1];\n    if (flipHor) {\n      scale[0] *= -1;\n    }\n    if (flipVert) {\n      scale[1] *= -1;\n    }\n    const texture = tileset.current!.tiles.find((t) => t.id === actualGid - tileset.current!.firstgid);\n    if (!texture) return null;\n\n    // the image is in the format \"tiles/structure-wall/tile-structure-wall-gray-left.png\"\n    // the 'structure-wall' part refers to the spritesheet, the 'tile-structure-wall-gray-left' is the texture on the spritesheet\n    const [\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      _,\n      spritesheet,\n      textureName\n    ] = texture.image.split(\"/\");\n    if (!tilesetsTextures[spritesheet]) {\n      console.warn(`Could not find spritesheet ${spritesheet} ${tilesetsTextures}`);\n    };\n    spritesheetTextures.current = tilesetsTextures[spritesheet].textures;\n    if (!spritesheetTextures.current![textureName]) {\n      console.warn(`Could not find texture ${spritesheet} ${textureName}`);\n    }\n\n    // the spritheet is to show different frames for different angles. \n    // it looks for sprites with the given type in the tileset. \n    // first frame is southeast, second frame is northeast\n    const animSpritesheet = o.properties?.find(p => p.name === 'spritesheet')?.value;\n    let textures;\n    if (animSpritesheet) {\n      const spritesheetTiles = tileset.current?.tiles?.filter(t => t.type === animSpritesheet).map(td => td.image);\n\n      textures = spritesheetTiles!.map((image) => {\n        const str = image.substr(image.lastIndexOf('/') + 1);\n        return tilesetsTextures[spritesheet].textures?.[str];\n      });\n    }\n    else {\n      textures = [spritesheetTextures.current![textureName]];\n    }\n    //const textures = spritesheetTiles!.map(t => console.log(t));\n    // (spritesheetTextures.current);\n\n    return (\n      <SpriteAnimated\n        name={`${o.name}: ${x},${y} (${textureName})`}\n        ref={ref}\n        scale={scale}\n        textures={textures}\n        // texture={spritesheetTextures.current![textureName]}\n        anchor={[0, 1]}\n        pivot={[TILE_WIDTH / 2, 0]}\n        position={tileLocationToPosition(location, mapData.width, mapData.height)}\n        pointerdown={() => onClick(o.name)}\n        interactive={!!o.name}\n        zIndex={getTileIndex(location, mapData.width)}\n      >\n        {renderEffects(o.properties)}\n        {found && <Sprite\n          ref={checkRef}\n          image={`${process.env.PUBLIC_URL}/images/ui/check.svg`}\n          scale={.8}\n          anchor={[-.1, 1]}\n          pivot={[TILE_WIDTH / 2, 0]}\n        />}\n      </SpriteAnimated> \n    );  \n  }\n  return null;\n}\n\nexport default MapObject;\n\nconst renderEffects = (properties?: TiledProperty[]) => {\n    if (!properties) return null;\n\n\n    let x, y;\n    const offset = properties.find(p => p.name === 'offset');\n    if (offset) {\n      [x, y] = offset.value.split(',');\n    }\n    \n    const effect = properties.find(p => p.name === 'effect');\n    if (effect?.value === 'smoke1') {\n      return (\n        <Smoke1 \n          x={x}\n          y={y}\n        />\n      )\n    }\n    return null;\n  }\n","import React, { useEffect, useRef, useState } from 'react';\nimport { Stage, Sprite, Container } from '@inlet/react-pixi';\nimport { TiledMapData, TiledLayerData, TiledLayerType, TiledObjectData } from 'utils/tiledMapData';\nimport * as PIXI from 'pixi.js';\nimport sound from 'pixi-sound';\nimport Viewport from '../Viewport';\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\nimport { TILE_HEIGHT, TILE_WIDTH, MARGIN_TOP} from 'constants/tiles';\nimport { tileLocationToPosition } from 'utils/isometric';\nimport FloorTileLayer from 'components/pixi/FloorTileLayer';\nimport Marker from 'components/pixi/Marker';\nimport { Content, Scenario } from 'data/Content';\nimport { findTileset } from 'utils/tiles';\nimport MapObject from '../MapObject';\n\n\n\ninterface Props { \n  content: Content;\n  mapData: TiledMapData;\n  tilesetsTextures: {[key: string]: any};\n  foundSituations: string[];\n  onSituationClick: (situation: string) => void;\n  solvedScenarios: string[];\n  onScenarioClick: (scenario: string) => void;\n}\n\n// // This stuff is needed for the pixi-js browser plugin\nif (process.env.NODE_ENV === \"development\") {\n  // @ts-ignore\n  // tslint:disable-next-line: no-unused-expression\n  window.__PIXI_INSPECTOR_GLOBAL_HOOK__ && window.__PIXI_INSPECTOR_GLOBAL_HOOK__.register({ PIXI });\n}\n\nconst Map = (props: Props) => {\n  const { content, foundSituations, mapData, tilesetsTextures, onSituationClick } = props;\n\n  const [screenWidth, setScreenWidth] = useState(window.innerWidth);\n  const [screenHeight, setScreenHeight] = useState(window.innerHeight);\n  // PIXI.settings.ROUND_PIXELS = false;\n\n  // https://stackoverflow.com/questions/4615116/how-to-calculate-the-height-and-width-of-an-isometric-rectangle-square\n  const mapWidth = ((mapData?.width || 1) + (mapData?.height || 1)) * (TILE_WIDTH / 2);\n  const mapHeight = ((mapData?.width || 1) + (mapData?.height || 1)) * (TILE_HEIGHT / 2) + MARGIN_TOP;\n\n  const viewportRef = useRef<PixiViewport>(null);\n\n  useEffect(() => {\n    // focus on center of the map\n    if (viewportRef.current) {\n        const viewport = viewportRef.current;\n        viewport.moveCenter(mapWidth / 2, mapHeight / 2);\n    }\n  }, [mapData, mapHeight, mapWidth, tilesetsTextures]);\n\n  \n  useEffect(() => {\n    if (!content.finder) {\n      // Only plop in scenario mode\n      sound.add('plops', {\n        url: `${process.env.PUBLIC_URL}/sound/plops.mp3`,\n        autoPlay: true,\n      });    \n    }\n  }, [content.finder]);\n\n  useEffect(() => {\n    const resize = () => {\n      setScreenWidth(window.innerWidth);\n      setScreenHeight(window.innerHeight);\n    }\n    window.addEventListener('resize', resize);\n    window.addEventListener('orientationchange', resize);\n \n    return () => {\n      window.removeEventListener('resize', resize);\n      window.removeEventListener('orientationchange', resize);\n    }\n  }, []);\n  \n\n  const renderFloor = (layer?: TiledLayerData) => {\n    if (!layer) {\n      console.warn(\"No layer with name 'floor' found!\");\n      return null;\n    }\n    const data = getTiles(layer);\n    const firstTileGid = data.find(Boolean);\n    if (!firstTileGid) {\n      console.warn(\"Layer with name 'floor' is empty?\");\n      return null;\n    }\n    const actualGid = firstTileGid & 0x1FFFFFFF;\n    const tileset = findTileset(actualGid, mapData!.tilesets);\n    if (!tileset) {\n      console.warn(\"No tileset found for floor layer. Huh?\");\n      return null;\n    }\n    const resource = tilesetsTextures[tileset.name];\n    PIXI.utils.clearTextureCache();\n\n    if (!resource.spritesheet) {\n      console.warn(`No texture loaded found for floor layer. Was looking for ${tileset.name}`);\n      return null;\n    }\n    return (\n      <FloorTileLayer \n        texture={(resource.spritesheet as any)._texture}\n        verticalTiles={mapData.height}\n        horizontalTiles={mapData.width}\n        layer={layer}\n        tileset={tileset}\n        spritesheet={resource.spritesheet}\n      />\n    )\n  }\n\n  const renderLayers = (layers: TiledLayerData[]) => {\n    return layers.filter(l => l.visible && l.name !== \"floor\" && l.type === TiledLayerType.tilelayer)\n      .map((layer: TiledLayerData, index: number) => {\n      const data = getTiles(layer);\n      return renderLayerTiles(data, layer, index)\n    });\n  } \n\n  const renderLayerTiles = (tileData: number[], layer: TiledLayerData, layerIndex: number) => {\n    return tileData.map((gid, i) => {\n      const actualGid = gid & 0x1FFFFFFF;\n      const tileset = findTileset(actualGid, mapData!.tilesets);\n      if (!tileset || !tileset.tiles || gid === 0) return null;\n\n      const columns = mapData!.width;\n      const x = (i % columns);\n      const y = Math.floor(i / columns);\n      // See https://discourse.mapeditor.org/t/data-field-in-the-tmx-format-json/3633\n      const flipHor = (gid & 0x80000000) !== 0;\n      const flipVert = (gid & 0x40000000) !== 0;\n      // const flipDiag = (gid & 0x20000000) !== 0;\n      const scale: [number, number] = [1, 1];\n      if (flipHor) {\n        scale[0] *= -1;\n      }\n      if (flipVert) {\n        scale[1] *= -1;\n      }\n      const texture = tileset.tiles.find((t) => t.id === actualGid - tileset.firstgid);\n      if (!texture) return null;\n\n      // the image is in the format \"tiles/structure-wall/tile-structure-wall-gray-left.png\"\n      // the 'structure-wall' part refers to the spritesheet, the 'tile-structure-wall-gray-left' is the texture on the spriesheet\n      const [\n        ,\n        spritesheet,\n        textureName\n      ] = texture.image.split(\"/\");\n      if (!tilesetsTextures[spritesheet]) {\n        console.warn(`Could not find spritesheet ${textureName} ${spritesheet} ${tilesetsTextures}`);\n      };\n      if (!tilesetsTextures[spritesheet].textures![textureName]) {\n        console.warn(`Could not find texture ${spritesheet} ${textureName}`);\n      }\n\n      return (\n        <Sprite\n          key={i}\n          name={`${layer.name}: ${x},${y} (${textureName})`}\n          scale={scale}\n          texture={tilesetsTextures[spritesheet].textures![textureName]}\n          anchor={[0, 1]}\n          pivot={[TILE_WIDTH / 2, 0]}\n          position={tileLocationToPosition([x, y], mapData.width, mapData.height)}\n          zIndex={i * 100 + layerIndex}\n        /> \n      );  \n    })\n  }\n\n  const renderObjectLayers = (layers: TiledLayerData[]) => {\n\n    return layers.filter(l => l.visible && l.type === TiledLayerType.objectgroup)\n      .map((layer: TiledLayerData) => {\n        return renderObjects(layer.objects);\n    });\n  } \n\n  const renderObjects = (objects: TiledObjectData[]) => {\n    return objects.filter(o => o.visible).map((o, index) => {\n      const found = foundSituations.indexOf(o.name) > -1;\n\n      return (\n        <MapObject\n          data={o}\n          key={`${o.type}${o.name}${index}`}\n          found={found}\n          tilesetsTextures={tilesetsTextures}\n          mapData={mapData}\n          onClick={onSituationClick}\n        />\n      )\n    })\n  }\n\n  const handleMarkerClick = (name: string) => {\n    props.onScenarioClick(name);\n  }\n\n  const renderScenarioMarker = (name: string, scenario: Scenario, index: number) => {\n    const delay = index * 0.25;\n    const position = tileLocationToPosition(scenario.location as [number, number], mapData.width, mapData.height);\n    const bounce = props.solvedScenarios.indexOf(name) === -1;\n    return (\n      <Marker \n        position={position} \n        pointertap={() => handleMarkerClick(name)}\n        delay={delay}\n        bounce={bounce}\n        key={name}\n        name={name}\n        scale={1.5}\n      />\n    ); \n  }\n\n  const options = { \n    sharedLoader: true,\n    backgroundColor: parseBackgroundColor(mapData?.backgroundcolor)\n  }\n\n  return (\n    <Stage width={screenWidth} height={screenHeight} className=\"background\" options={options}>\n      <Viewport\n        worldWidth={mapWidth}\n        worldHeight={mapHeight}\n        screenWidth={screenWidth}\n        screenHeight={screenHeight}\n        ref={viewportRef}\n      >\n        {renderFloor(mapData.layers.find(l => l.name === \"floor\"))}\n        {/* <Graphics\n            name=\"selectioncircle\"\n            draw={graphics => {\n                const line = 3;\n                graphics.lineStyle(line, 0xFFFFFF);\n                graphics.drawCircle(0, 0, 5);\n                graphics.endFill();\n            }}\n            position={tileLocationToPosition([0, 0], mapData.width, mapData.height)}\n\n        /> */}\n        <Container sortableChildren={true}>\n          {renderLayers(mapData.layers)}\n        </Container>\n        <Container sortableChildren={true}>\n          {renderObjectLayers(mapData.layers)}\n        </Container>\n        {Object.entries(content.scenarios || []).map(([key, value], index) => renderScenarioMarker(key, value, index))}\n      </Viewport>\n    </Stage>\n  );\n}\n\nexport default Map;\n\n\nconst parseBackgroundColor = (asString: string | undefined) : number | undefined => {\n  if (!asString) { return; }\n  return parseInt(asString.substring(1), 16); // strip the hash, conver to int\n}\n\nconst getTiles = (layer: TiledLayerData): number[] => {\n\n    let rawData = layer.data;\n\n    if (typeof(rawData) !== 'string') {\n      // return new Uint8Array(rawData);\n      return rawData;\n    }\n\n    // ==================================\n    // == If applicable, decode Base64 ==\n    // ==================================\n    if(layer.encoding === 'base64') {\n        // data = base64.decode(rawData);\n        // data = base64.decode(\"dGVzdA==\");\n    }\n\n    // ============================================\n    // == If applicable, extract compressed data ==\n    // ============================================\n    if(layer.compression === 'gzip') {\n    //    data = zlib.gunzipSync(data);\n    }\n\n    // ====================================\n    // == Read buffer data every 4 bytes ==\n    // ====================================\n\n    // Each 32-bit integer is placed in an 8-bit integer array.\n    // There will never be a tile ID greater than 255, so only 1 byte is required.\n    // let array = new Uint8Array(layer.width * layer.height);\n    // for(let i=0, index=0; i<data.length; i += 4, index++) {\n    //     array[index] = data.readUInt32LE(i);\n    //     index++;\n    // }\n    // return array;\n    return [];\n}","var _defs, _circle, _path, _path2, _path3, _line, _line2;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgClose(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: 30.04,\n    height: 30.04,\n    viewBox: \"0 0 30.04 30.04\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"style\", null, \".a{fill:#fff;}.a,.b{stroke:#283583;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.75px;}.b{fill:none;}\"))), title === undefined ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, \"Back\") : title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    className: \"a\",\n    cx: 15.02,\n    cy: 15.02,\n    r: 14.65\n  })), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"b\",\n    d: \"M11.64,16\",\n    transform: \"translate(-0.97 -0.93)\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"b\",\n    d: \"M11.63,16\",\n    transform: \"translate(-0.97 -0.93)\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"b\",\n    d: \"M20.38,22.88\",\n    transform: \"translate(-0.97 -0.93)\"\n  })), _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    className: \"b\",\n    x1: 19.39,\n    y1: 8.16,\n    x2: 10.65,\n    y2: 15.02\n  })), _line2 || (_line2 = /*#__PURE__*/React.createElement(\"line\", {\n    className: \"b\",\n    x1: 19.39,\n    y1: 21.98,\n    x2: 10.65,\n    y2: 15.11\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgClose);\nexport default __webpack_public_path__ + \"static/media/close.72346ed5.svg\";\nexport { ForwardRef as ReactComponent };","var _defs, _circle, _path, _path2, _path3, _line, _line2;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgBack(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: 30.04,\n    height: 30.04,\n    viewBox: \"0 0 30.04 30.04\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"style\", null, \".a{fill:#fff;}.a,.b{stroke:#283583;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.75px;}.b{fill:none;}\"))), title === undefined ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, \"Back\") : title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    className: \"a\",\n    cx: 15.02,\n    cy: 15.02,\n    r: 14.65\n  })), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"b\",\n    d: \"M11.64,16\",\n    transform: \"translate(-0.97 -0.93)\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"b\",\n    d: \"M11.63,16\",\n    transform: \"translate(-0.97 -0.93)\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"b\",\n    d: \"M20.38,22.88\",\n    transform: \"translate(-0.97 -0.93)\"\n  })), _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    className: \"b\",\n    x1: 19.39,\n    y1: 8.16,\n    x2: 10.65,\n    y2: 15.02\n  })), _line2 || (_line2 = /*#__PURE__*/React.createElement(\"line\", {\n    className: \"b\",\n    x1: 19.39,\n    y1: 21.98,\n    x2: 10.65,\n    y2: 15.11\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgBack);\nexport default __webpack_public_path__ + \"static/media/back.72346ed5.svg\";\nexport { ForwardRef as ReactComponent };","import React, {  useEffect } from 'react';\nimport './style/styles.css';\nimport { ReactComponent as CloseIcon } from './style/close.svg';\n\ninterface Props {\n    disableBackButton?: boolean;\n    gameDataReceived: (gameData: any) => void;\n}\n\n// start w  REACT_APP_PLAYER_MODE=true npm start\n\nconst PlayerBridge = (props: Props) => {   \n    const {gameDataReceived, disableBackButton} = props;\n    \n    const back = () => {       \n        send({\n            type: 'back'\n        });\n    }\n\n    useEffect(() => {\n        if (!process.env.REACT_APP_PLAYER_MODE) {\n            return;\n        }\n        let interval: NodeJS.Timeout;\n        \n        const check = () => {\n            // @ts-ignore\n            if (window.GAMEDATA) {\n                clearInterval(interval);\n                // @ts-ignore\n                gameDataReceived(window.GAMEDATA);\n            }\n        }\n        // cordova iab just sets window.GAMEDATA\n        interval = setInterval(check, 250);\n\n        // @ts-ignore\n        window.setGameData = (gameData) => {\n            send({\n                type: 'setGameData',\n                data: gameData\n            });\n        }\n             \n        // @ts-ignore\n        window.exit = () => {\n            send({\n                type: 'exit'\n            });\n        }\n\n        // @ts-ignore\n        window.getGameData = () => {\n            // @ts-ignore\n            return window.GAMEDATA;\n        }   \n\n        return () => {\n            clearInterval(interval);\n        }\n    }, [gameDataReceived]);\n\n    if (!process.env.REACT_APP_PLAYER_MODE) {\n        return null;\n    }\n\n    if (disableBackButton === true) {\n        return null;\n    }\n    return (\n        <div className=\"close\">\n            <CloseIcon onClick={back} />\n        </div>\n    )\n}\n\nexport default PlayerBridge;\n\nexport const send = (payload: any) => {\n    // @ts-ignore\n    if (window.hasOwnProperty(\"webkit\") && window.webkit.hasOwnProperty(\"messageHandlers\")){\n        var stringifiedMessageObj = JSON.stringify(payload);\n        // Send to In App Browser context\n        // @ts-ignore\n        webkit.messageHandlers.cordova_iab.postMessage(stringifiedMessageObj);\n    }\n    else {\n        // @ts-ignore\n        window.parent.postMessage(payload, '*');\n    }\n}\n","import React from 'react';\nimport './styles/finderBox.scss';\nimport { FinderContent } from 'data/Content';\n\ninterface Props {\n  content: FinderContent;\n  instructionText: string;\n  foundSituations: string[];\n  nextText: string;\n  onOpenGame: () => void;\n}\n\nconst FinderBox = (props: Props) => {\n  const disabled = props.foundSituations.length < props.content.situations.length;\n  return (\n    <div className=\"finder-box\">\n      {`${props.instructionText} (${props.foundSituations.length}/${props.content.situations.length})`} \n      <button className=\"green button\" disabled={disabled} onClick={props.onOpenGame}>        \n        {props.nextText}\n      </button>\n    </div>\n  )\n}\n\nexport default FinderBox;","import React, { useEffect, useRef } from 'react';\nimport './styles/modal.css';\nimport { ContentConfig } from 'data/Content';\nimport { GameData } from 'components/playerBridge/GameData';\nimport { send } from 'components/playerBridge';\n\ninterface GameDataEvent {\n  data: {\n    type: 'exit' | 'setGameData' | 'back',\n    data: GameData<any>;\n  }\n}\n\ninterface Props {\n  content: ContentConfig;\n  open: boolean;\n  onBack?: () => void;\n  onSetGameData: (data: GameData<any>) => void\n}\n\nconst IFrameModal = (props: Props) => {\n  const { onBack, onSetGameData, content} = props;\n  const ref = useRef<HTMLIFrameElement>(null);\n\n  useEffect(() => {\n    const handleLoad = () => {\n      // Send gamedata to iframe. Iframe needs to pick this up and serve it to the game when needed\n      ref?.current?.contentWindow?.postMessage(content.data, '*');\n    };\n\n    const handleMessage = (event: GameDataEvent) => {\n      switch (event.data.type) {\n        case 'setGameData':\n          // The iframe is sending a GameData to be stored\n          onSetGameData(event.data.data);\n          break;\n        case 'back':\n          if (onBack) { onBack(); }\n          break;\n        case 'exit':\n          send({\n            type: 'exit'\n          });\n          break;\n      }\n    };\n    ref?.current?.addEventListener('load', handleLoad, true);\n    window.addEventListener('message', handleMessage, true);\n\n  }, [content.data, onBack, onSetGameData]);\n\n  return (\n      <iframe \n        src={content.url} \n        ref={ref} \n        title={content.url} \n        className={`iframe-content ${props.open ? \"visible\" : \"hidden\"}`}\n      >\n      </iframe>\n  )\n}\n\nexport default IFrameModal;\n\n","import React from 'react';\nimport './styles/scenariosBox.scss';\nimport { Scenario } from 'data/Content';\n\ninterface Props {\n    scenarios: { [key: string]: Scenario }\n    solvedScenarios: string[];\n    nextText: string;\n    instructionText: string;\n    onComplete: () => void;\n}\n\nconst ScenarioBox = (props: Props) => {\n    const {scenarios, solvedScenarios} = props;\n    const scenariosNames = Object.keys(scenarios);\n    const disabled = solvedScenarios.length < scenariosNames.length;\n\n    return (\n        <div className=\"scenarios-box\">\n            {`(${solvedScenarios.length}/${scenariosNames.length})`} \n            <button className=\"green button\" disabled={disabled} onClick={props.onComplete}>                \n                {props.nextText}\n            </button>\n        </div>\n    )\n}\n\nexport default ScenarioBox;","import { ScenarioReaction } from 'data/Content';\nimport React from 'react';\n\ninterface Props {\n  scenario: string;\n  texts: {[key: string]: string};\n  reactions: ScenarioReaction[];\n  selected?: string;\n  onSelect: (id: string) => void;\n}\n\nconst Reactions = (props: Props) => {\n  return (\n      <ul>\n        {props.reactions.map(r => {\n          const handleClick = () => {\n            props.onSelect(r.id);\n          }\n          return (\n            <li key={r.id} onClick={handleClick} className={`${props.selected === r.id ? \"selected\": \"\"}`}>\n              {props.texts[`reaction-${props.scenario}-${r.id}`]}\n            </li>\n          )\n        })}\n      </ul>\n  );\n}\n\nexport default Reactions;","import { ScenarioReaction } from 'data/Content';\nimport React from 'react';\n\ninterface Props {\n  correct: boolean;\n  texts: {[key: string]: string};\n}\n\nconst FeedbackTitle = (props: Props) => {\n  if (props.correct) {\n    return (\n      <h1 className=\"correct\">\n        {props.texts[\"feedback-correct\"]}\n      </h1>     \n    );\n  }\n  return (\n    <h1 className=\"wrong\">\n      {props.texts[\"feedback-wrong\"]}\n    </h1>     \n  );\n}\n\nexport default FeedbackTitle;\n","var _style, _circle, _path, _path2, _path3, _line, _line2;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgClose(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"Layer_1\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    x: \"0px\",\n    y: \"0px\",\n    viewBox: \"0 0 30 30\",\n    style: {\n      enableBackground: \"new 0 0 30 30\"\n    },\n    xmlSpace: \"preserve\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), _style || (_style = /*#__PURE__*/React.createElement(\"style\", {\n    type: \"text/css\"\n  }, \"\\n\\t.st0{fill:#FFFFFF;stroke:#283583;stroke-width:0.75;stroke-linecap:round;stroke-linejoin:round;}\\n\\t.st1{fill:none;stroke:#283583;stroke-width:0.75;stroke-linecap:round;stroke-linejoin:round;}\\n\")), title === undefined ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, \"Back\") : title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    className: \"st0\",\n    cx: 15,\n    cy: 15,\n    r: 14.6\n  })), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"st1\",\n    d: \"M10.7,15.1\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"st1\",\n    d: \"M10.7,15.1\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"st1\",\n    d: \"M19.4,21.9\"\n  })), _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    className: \"st1\",\n    x1: 22.9,\n    y1: 7.2,\n    x2: 7.2,\n    y2: 22.9\n  })), _line2 || (_line2 = /*#__PURE__*/React.createElement(\"line\", {\n    className: \"st1\",\n    x1: 22.9,\n    y1: 22.9,\n    x2: 7.2,\n    y2: 7.2\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgClose);\nexport default __webpack_public_path__ + \"static/media/close.deade97f.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { gsap } from 'gsap'\nimport { TextPlugin } from 'gsap/all';\nimport sound from 'pixi-sound';\nimport { Hotspot, Scenario } from 'data/Content';\nimport ReactMarkdown from 'react-markdown';\nimport Reactions from './Reactions';\nimport FeedbackTitle from './FeedbackTitle';\nimport { ReactComponent as BackIcon } from './styles/back.svg';\nimport { ReactComponent as CloseIcon } from './styles/close.svg';\n\nimport \"./styles/scenarioScreen.scss\";\n\ngsap.registerPlugin(TextPlugin);\n\ninterface Props {\n  scenario: string;\n  content: Scenario;\n  texts: {[key: string]: string};\n  selectedReaction?: string; // When reaction has been set correctly before\n  setCorrectReaction: (index: string) => void;\n  onBack: () => void;\n}\n\nenum State {\n  description,\n  reactions,\n  feedback,\n}\n\nconst ScenarioScreen = (props: Props) => {\n  const {content, texts} = props;\n  const ref = useRef<HTMLDivElement>(null);\n  const reopeningCorrectScenario = useRef<boolean>(!!props.selectedReaction);\n  const [state, setState] = useState(State.description);\n  const [image, setImage] = useState<string>(); // zoomed in image\n  const [selectedReaction, setSelectedReaction] = useState<string|undefined>(props.selectedReaction);\n\n  const handleClickNextDescription = () => {\n    setState(State.reactions)\n  }\n\n  const handleGoToDescription = () => {\n    setState(State.description)\n  }\n  \n  const handleGoToFeedback = () => {\n    setState(State.feedback);\n    setTimeout(() => {\n      if (selectedReactionCorrect) {\n        sound.play('correct');\n        props.setCorrectReaction(selectedReaction!);\n      } else {\n        sound.play('wrong');\n      }\n    }, 500);\n  }\n\n  useEffect(() => {\n    const slideTransitionTime = 500;\n    const timeout = setTimeout(() => {\n      ref.current?.querySelector('.content')?.scroll({top: 0, left: 0, behavior: 'smooth' });\n    }, slideTransitionTime);\n    return () => {\n      clearTimeout(timeout);\n    }\n  }, [state]);\n  \n  useEffect(() => {\n    sound.add('correct', `${process.env.PUBLIC_URL}/sound/correct.mp3`);    \n    sound.add('wrong', `${process.env.PUBLIC_URL}/sound/wrong.mp3`);\n  }, []);\n  \n  // shown on the feedback page\n  const selectedReactionText = useMemo(() => {\n    if (!selectedReaction) return \"\";\n    const id = content.reactions.find(r => r.id === selectedReaction)?.id;\n    return texts[`reaction-${props.scenario}-${id}`];\n  }, [content.reactions, props.scenario, texts, selectedReaction]); \n  \n  const selectedReactionCorrect = useMemo(() => {\n    if (!selectedReaction) return false;\n    return content.reactions.find(r => r.id === selectedReaction)?.correct === true;\n  }, [content.reactions, selectedReaction]);\n\n  const handleHotspotClick = (event: React.MouseEvent<HTMLDivElement>) => {\n    // Zoom in on image\n    if((event.target as HTMLElement).tagName === \"IMG\") {\n      const path = (event.target as HTMLImageElement)?.getAttribute(\"data-img\");\n      if (path) {\n        setImage(path);\n      }\n    }\n  };\n\n  const handleCloseImage = () => {\n    setImage(undefined);\n  }\n\n  const imageUrl = useMemo(() => {\n    const parseUrl = (url: string) => {\n      // url can be either a direct path or a key in the translation section\n      if (url.startsWith('http')){\n        return url;\n      }\n      return texts[url];\n    }\n    if (content.image && state !== State.feedback) {\n      return parseUrl(content.image);\n    }\n    if (content.imageFeedback && state === State.feedback) {\n      return parseUrl(content.imageFeedback);\n    }\n    return null;\n  }, [content.image, content.imageFeedback, state, texts]);\n\n  return (\n    <>\n    <div className={`scenario-screen`} ref={ref}>\n      <div className=\"illustration\">\n        <div className=\"scaler\" >\n          { imageUrl && <img src={imageUrl} alt=\"\" ></img> }\n          { ( content.hotspots && state !== State.feedback\n            ) && content.hotspots.map((h: Hotspot) => {\n            return (\n              <img \n                className=\"hotspot\"\n                key={h.image}\n                style={{\n                  left: `${h.left}%`,\n                  top: `${h.top}%`,\n                  width: `${h.width}%`,\n                }}\n                alt=\"\"\n                data-img={h.image}\n                onClick={handleHotspotClick}\n                src={h.hotspot}\n              />\n            )\n          })}\n        </div>\n      </div>\n      <div className={`content state-${State[state]} ${reopeningCorrectScenario.current ? \"reopening\" : \"\"}`}>\n        <div className=\"description\" >\n          <ReactMarkdown source={texts[`description-${props.scenario}`]} />\n          <div className=\"buttons\">\n            <button className=\"button right-align white\" onClick={handleClickNextDescription}>\n              {texts[\"button-next\"]}\n            </button>\n          </div>\n        </div>\n        <div className=\"reactions\">\n          <h1>{texts[\"reactions\"]}</h1>\n          <Reactions\n            scenario={props.scenario}\n            texts={texts}\n            selected={selectedReaction}\n            onSelect={setSelectedReaction}\n            reactions={content.reactions} \n          />\n          <div className=\"buttons\">\n            <button className=\"button white\" onClick={handleGoToDescription}>\n              {texts[\"button-prev\"]}\n            </button>\n            <button \n              className={`button ${selectedReaction ? \"green\" : \"\"}`} \n              onClick={handleGoToFeedback}\n              disabled={!selectedReaction}\n            >\n             {texts[\"button-check\"]}\n            </button>\n          </div>\n        </div>\n        <div className=\"feedback\">\n          <FeedbackTitle \n            texts={texts}\n            correct={selectedReactionCorrect}\n          />\n          <p className={`reaction ${selectedReactionCorrect ? \"correct\" : \"wrong\"}`}>\n           {selectedReactionText}\n          </p>\n          <h1 className=\"title\">{texts[\"feedback\"]}</h1>\n          <ReactMarkdown source={texts[`feedback-${props.scenario}`]} />\n          <div className=\"buttons\">\n            {reopeningCorrectScenario.current && \n              (<button className=\"button white\" onClick={handleGoToDescription}>\n                {texts[\"button-prev\"]}\n              </button>\n            )}\n            <button \n              className={`button green right-align`} \n              onClick={props.onBack}\n            >\n              {texts[\"button-continue\"]}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div className=\"close\">\n        <BackIcon onClick={props.onBack} />\n    </div>\n    { image && (<div className=\"image\">\n      <img src={image} alt=\"img\" />\n      <div className=\"close-image\">\n        <CloseIcon onClick={handleCloseImage} />\n      </div>\n    </div>)}\n    </>\n  )\n}\n\nexport default ScenarioScreen;\n","var _defs, _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgStarEmpty(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: 141.478,\n    height: 134.378,\n    viewBox: \"0 0 141.478 134.378\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"style\", null, \"\\n            .star-empty {\\n                fill: #f8f8f8;\\n                stroke: #b0b0b0;\\n                stroke-width: 3px;\\n            }\\n        \"))), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"star-empty\",\n    d: \"M67.517,0l21.1,42.2,46.418,6.752L101.275,81.864l7.6,46.418L67.517,106.339,26.163,128.282l7.6-46.418L0,48.95,46.418,42.2Z\",\n    transform: \"translate(3.223 3.354)\"\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgStarEmpty);\nexport default __webpack_public_path__ + \"static/media/star-empty.fb60bd87.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react';\nimport './styles/loading.css';\n\nconst Loading = () => {\n    return (\n        <div className=\"loading-background\">\n            <div className=\"white-block\">\n                <div className=\"outset\"></div>\n                <div className=\"blue-block\"></div>\n            </div>\n            <div className=\"subtext\">\n                Stay curious\n                <span className='dots'><span className='dot1'>.</span><span className='dot2'>.</span><span className='dot3'>.</span></span>\n            </div>\n        </div>\n    )\n}\n\nexport default Loading;\n","import React, { PropsWithChildren } from 'react';\nimport './styles/baseDialog.scss';\n\ninterface Props {\n  className: string;\n}\n\nconst BaseDialog = (props: PropsWithChildren<any>) => {\n  return (\n    <div className={`basedialog ${props.className}`}>\n        {props.children}\n    </div>\n  );\n}\n\nexport default BaseDialog;","import React from 'react';\nimport BaseDialog from './BaseDialog';\nimport { ReactComponent as StarEmpty } from './../../common/images/star-empty.svg';\nimport './styles/introDialog.scss';\n\ninterface Props {\n  headerText: string;\n  descriptionText: string;\n  starsToGainText: string;\n  startText: string;\n  onStart: () => void;\n}\n\nconst IntroDialog = (props: Props) => {\n  return (\n    <BaseDialog className=\"intro-dialog\">\n      <div className=\"top\">\n        <h1>{props.headerText}</h1>\n      </div>\n      <div className=\"center\">\n        <section>{props.descriptionText}</section>\n      </div>  \n      <div className=\"bottom\">\n        <StarEmpty className=\"star\"/>\n        <span className=\"stars-to-gain\">\n          {props.starsToGainText}\n        </span>\n        <button className=\"green button start\" onClick={props.onStart}>\n          {props.startText}\n        </button>\n      </div>\n    </BaseDialog>\n  );\n}\n\nexport default IntroDialog;","import { Loader } from \"pixi.js\";\n\ninterface Location {\n    x: number;\n    y: number;\n}\n\nexport const lerpLocation = (point1: Location, point2: Location, alpha: number): Location => {\n    const x = lerp(point1.x, point2.x, alpha);\n    const y = lerp(point1.y, point2.y, alpha);\n    return { x, y };\n}\n\nconst lerp = (n1: number,  n2: number,  alpha: number) =>  {\n    return n1 + alpha * (n2 - n1);\n}\n\n// Uses the shared pixi loader to load a resource\nexport async function loadResourceAsync(path: string) { \n    const loader = Loader.shared;\n    return new Promise<any>((resolve, reject) => {\n    if (loader.resources[path]) {\n            resolve(loader.resources[path]);\n        }\n        else {\n            loader.add(path).load((_, resources) => {\n                resolve(resources[path]);\n            });\n        }\n    });\n}\n\nexport const loadResource = (path: string, callback: (resource: any) => void) => { \n    const loader = Loader.shared;\n    if (loader.resources[path]) {\n        callback(loader.resources[path]);\n        return;\n    }\n    loader.add(path).load((_, resources) => { callback(resources[path]!)});\n}","var _defs, _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgStarFull(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: 135.033,\n    height: 128.282,\n    viewBox: \"0 0 135.033 128.282\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"style\", null, \"\\n            .star-full {\\n                fill: #fcda00;\\n            }\\n        \"))), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    className: \"star-full\",\n    d: \"M67.517,0l21.1,42.2,46.418,6.752L101.275,81.864l7.6,46.418L67.517,106.339,26.163,128.282l7.6-46.418L0,48.95,46.418,42.2Z\"\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgStarFull);\nexport default __webpack_public_path__ + \"static/media/star-full.7791fa1a.svg\";\nexport { ForwardRef as ReactComponent };","import { useState, useEffect, useCallback } from \"react\";\nimport { TiledTilesetData } from \"utils/tiledMapData\";\nimport { loadResource } from \"utils/pixiJs\";\nimport { LoaderResource } from \"pixi.js\";\n\nconst useTilesetsLoader = (determineTilesetSpritesheetPath: (tileset: TiledTilesetData) => string) => {\n    const [tilesetsTextures, setTilesets] = useState<{[key: string]: any}>({});\n    const [data, setData] = useState<TiledTilesetData[]>();\n\n    const loadTilesets = useCallback((value: TiledTilesetData[]) => {\n        setData(value);\n    }, []);\n\n    useEffect(() => {\n        if (!data) return;\n        const nextTileset = nextTilesetToload(data, tilesetsTextures);\n        if (!nextTileset) return;\n        \n        const tilesetName = nextTileset.name;\n        const path = determineTilesetSpritesheetPath(nextTileset);\n        loadResource(`${path}`, (resource) => {\n            if (resource.error) {\n                throw new Error(`Loading ${path}\\n${resource.error}`);\n            }\n            const newTilesets = { \n                ...tilesetsTextures,\n                [tilesetName]: resource\n            }\n            setTilesets(newTilesets);\n        });\n    }, [data, determineTilesetSpritesheetPath, tilesetsTextures]);\n    \n    const loadComplete = !!data && nextTilesetToload(data, tilesetsTextures) === undefined;\n\n    return {\n        loadComplete,\n        loadTilesets,\n        tilesetsTextures\n    }\n}\n\nexport default useTilesetsLoader;\n\n// Returns a TiledTilesetData that has not been loaded into tilesetsTextures yet\nconst nextTilesetToload = (tilesets: TiledTilesetData[], tilesetsTextures: {[key: string]: any}) => {\n    return tilesets.find((t) => {\n        return !tilesetsTextures[t.name];\n    })\n}","import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport Map from \"./components/pixi/Map\";\nimport PlayerBridge, { send } from 'components/playerBridge';\nimport { GameData, Level } from 'components/playerBridge/GameData';\nimport { Content, ContentConfig, Scenario } from 'data/Content';\nimport { PixiPlugin } from 'gsap/all';\nimport { gsap } from 'gsap';\nimport FinderBox from 'components/FinderBox';\nimport IFrameModal from 'components/IFrameModal';\nimport ScenarioBox from 'components/ScenariosBox';\nimport ScenarioScreen from 'components/ScenarioScreen';\nimport Loading from 'components/playerBridge/Loading';\nimport IntroDialog from 'components/dialogs/IntroDialog';\nimport useTilesetsLoader from 'hooks/useTilesetsLoader';\nimport { TiledTilesetData, TiledMapData } from 'utils/tiledMapData';\nimport { loadResource } from 'utils/pixiJs';\nimport CompleteDialog from 'components/dialogs/CompleteDialog';\nimport './styles/common.scss'\nimport './App.css';\nimport * as PIXI from 'pixi.js';\n\ndeclare global {\n  interface Window { PIXI: any; }\n}\n\nwindow.PIXI = PIXI;\nPixiPlugin.registerPIXI(PIXI);\ngsap.registerPlugin(PixiPlugin);\n\n\nenum GameState {\n  intro = 0,\n  normal = 1 << 1,\n  wrong = 1 << 2,\n  correct = 1 << 3,\n  complete = 1 << 4\n}\n\nfunction App() {\n  const [state, setState] = useState(GameState.intro);\n  const [translations, setTranslations] = useState<{[key: string]: string}>({});\n  const [mapData, setMapData] = useState<TiledMapData>();\n  const [data, setData] = useState<GameData<Content>>();\n\n  const [scenario, setScenario] = useState<string|undefined>();\n  const [foundSituations, setFoundSituations] = useState<string[]>([]);\n  const [scenarioReactions, setScenarioReactions] = useState<{[key: string]: string}>({}); // key = scenario, value = reaction id\n  const [iframeOpen, setIframeOpen] = useState(false);\n\n  const handleBack = useCallback(() => {\n    setIframeOpen(false);\n  }, []);\n\n  const handleSetGameData = useCallback((data: GameData<any>) => {\n    // @ts-ignore\n    window.setGameData(data);\n  }, []);\n  const handleGameDataReceived = useCallback((data: GameData<Content>) => {\n\n    // PIXI.settings.SCALE_MODE = SCALE_MODES.NEAREST; // prevent lines on the edges of tiles\n    setData(data);\n    \n    if (data.translations){\n      const t = data.translations.reduce<{[key: string]: string}>((acc, translation) => {\n        acc[translation.key] = translation.value;\n        return acc;\n      }, {});\n      setTranslations(t);\n    }\n\n    // console.log(data.translations.map(t => `${t.key}`).join('\\n'))\n    // console.log(data.translations.map(t => t.value).join('\\n'))\n  }, []);\n\n  const content = useMemo(() => data?.content, [data]);\n  const levelsCompleted = useMemo(() => data?.levelsCompleted, [data]);\n\n  const {\n    loadComplete,\n    loadTilesets,\n    tilesetsTextures\n  } = useTilesetsLoader(determineTilesetSpritesheetPath);\n  \n  useEffect(() => {\n    if (!content) return;\n\n    // Content loaded, load map json\n    const jsonPath = content.mapJson;\n    loadResource(`${process.env.PUBLIC_URL}/${jsonPath}`, (resource) => {\n      setMapData(resource.data);\n    });    \n  }, [content]);\n\n  useEffect(() => {\n    if (!mapData) return;\n\n    loadTilesets(mapData.tilesets);    \n  }, [loadTilesets, mapData]);\n\n  useEffect(() => {\n    // @ts-ignore\n\n    // See if we are fed gamedata by 21ccplayer app, if not, go fetch it ourselves\n    if (!process.env.REACT_APP_PLAYER_MODE) {\n      // @ts-ignore\n      if(!content) {\n        console.log(\"no bridge found, fetching fallback\")\n        // @ts-ignore\n        \n        // fetch(`${process.env.PUBLIC_URL}/config/data-fireextinguishers.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/data-emergencyexits.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/data-aeds.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/data-dangeroussituations.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/scenarios-1.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/scenarios-1_HI.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/scenarios-1_EN.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/scenarios-1_CH.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/scenarios-1_MS.json`)\n        fetch(`${process.env.PUBLIC_URL}/config/scenarios-1-microsoft_EN.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/scenarios-1-microsoft_HI.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/scenarios-2.json`)\n        // fetch(`${process.env.PUBLIC_URL}/config/scenarios-3.json`)\n        .then((response) => {\n          response.json().then((data) => {\n\n            handleGameDataReceived(data);\n          })\n        })\n      }\n    };\n  }, [content, handleGameDataReceived]); \n\n  const iframe = useMemo(() => {\n    if (!levelsCompleted) return;\n    if (!content?.finder?.final) return;\n\n    // Copy the levelsCompleted of VCA game into minigame\n    const final: ContentConfig = {\n      ...content?.finder?.final!,\n      data: {\n        ...content?.finder?.final.data!,\n        levelsCompleted\n      }\n    }\n    return final;\n  }, [content, levelsCompleted]);\n\n  const handleOpenGame = () => {\n    setIframeOpen(true);\n  }\n\n  const handleComplete = () => {\n    setState(GameState.complete);\n\n    handleSetGameData({\n      ...data!,\n      levelsCompleted: [{\n        level: 1,\n        score: solvedScenarios.length,\n        maxScore: solvedScenarios.length\n      }]\n    });\n  }\n\n  const handleStart = useCallback(() => {   \n    setState(GameState.normal); \n  }, []);\n  \n  const handleSituationClick = (situation: string) => {\n    if (!content?.finder) return;\n\n    if (content.finder.situations.indexOf(situation) > -1 && foundSituations.indexOf(situation) === -1){\n      setFoundSituations([...foundSituations, situation]);\n    }\n  }\n  \n  const handleScenarioClick = (scenario: string) => {\n    setScenario(scenario);\n  }\n\n  // useEffect(() => {\n  //   // todo: just for testing remove!\n  //   setScenario(\"test\");\n  // }, [content]);\n    \n  const handleCorrectReaction = (reaction: string) => {\n    // gets called from within modal once the correct answer is selected\n\n    setScenarioReactions({\n      ...scenarioReactions,\n      [scenario!]: reaction\n    });\n  }\n\n  const exitScenario = () => {\n    setScenario(undefined);\n  }\n\n  const handleExit = () => {\n    send({\n      type: 'exit'\n    });\n  }\n\n  const handleReset = () => { \n    setState(GameState.normal);\n    setScenarioReactions({});\n  }\n\n  const starsToGainText = useMemo<string>(() => {\n    const currentScore = levelsCompleted?.[0]?.score || 0;\n    // const maxScore = content?.finder?.situations.length || 0;\n    const maxScore = content?.stars || 1;\n    return (\"\" + translations[\"intro-stars-to-gain\"])\n      .replace(\"{0}\", \"\"+currentScore)\n      .replace(\"{1}\", \"\"+maxScore);\n  }, [content, levelsCompleted, translations]);\n\n  const solvedScenarios = useMemo(() => {\n    return Object.keys(scenarioReactions || {});\n  }, [scenarioReactions]);\n\n\n  return (\n    <>\n      {(!loadComplete) && (          \n        <Loading />\n      )}\n      <div className=\"background\" >\n        <PlayerBridge \n          gameDataReceived={handleGameDataReceived}\n          disableBackButton={!!iframeOpen || !!scenario}\n\n        />\n        {loadComplete && (\n          <>\n            {(state === GameState.intro) &&\n            (<IntroDialog\n              onStart={handleStart}\n              headerText={translations[\"intro-header\"]}\n              descriptionText={translations[\"intro-description\"]}\n              starsToGainText={starsToGainText}\n              startText={translations[\"intro-start\"]}\n            />)}\n            {(state === GameState.normal) && mapData && content && (\n              <>\n                <Map \n                  content={content}\n                  mapData={mapData}\n                  tilesetsTextures={tilesetsTextures}\n                  onSituationClick={handleSituationClick} \n                  foundSituations={foundSituations}\n                  solvedScenarios={solvedScenarios}\n                  onScenarioClick={handleScenarioClick}\n                />\n                {content?.finder && (\n                  <FinderBox \n                    content={content.finder} \n                    instructionText={translations[\"finder-instruction\"]}\n                    nextText={translations[\"button-next\"]}\n                    foundSituations={foundSituations} \n                    onOpenGame={handleOpenGame}\n                  />\n                )}\n                {content?.scenarios && (\n                  <ScenarioBox \n                    scenarios={content.scenarios}\n                    solvedScenarios={solvedScenarios} \n                    instructionText={translations[\"finder-instruction\"]}\n                    nextText={translations[\"button-next\"]}\n                    onComplete={handleComplete}\n                  />\n                )}\n              </>\n            )}\n            {iframe && (\n              <IFrameModal \n                content={iframe}\n                open={iframeOpen}\n                onBack={handleBack} \n                onSetGameData={handleSetGameData} \n              />\n            )}\n            {scenario && (\n              <ScenarioScreen \n                scenario={scenario}\n                content={content?.scenarios[scenario]!}\n                selectedReaction={scenarioReactions[scenario]}\n                setCorrectReaction={handleCorrectReaction}\n                texts={translations}\n                onBack={exitScenario}\n              />\n            )}\n            {(state === GameState.complete) &&\n              (<CompleteDialog\n                onTryAgain={handleReset}\n                onExit={handleExit}\n                total={Object.keys(content?.scenarios!).length || 0}\n                mistakes={0}\n                headerText={translations[\"complete-header\"]}\n                scoreText={translations[\"complete-score\"]}\n                tryAgainText={translations[\"complete-try-again\"]}\n                exitText={translations[\"complete-exit\"]}\n              />)}\n          </>\n        )}\n      </div>\n    </>\n  );\n}\n\nexport default App;\n\n// returns the path to the spritesheet for given tileset\nconst determineTilesetSpritesheetPath = (tilesetData: TiledTilesetData) => `${process.env.PUBLIC_URL}/maps/tilesets/${tilesetData.name}.json`;\n\n\n","import React, { useEffect } from 'react';\nimport BaseDialog from './BaseDialog';\nimport { ReactComponent as StarEmpty } from './../../common/images/star-empty.svg';\nimport { ReactComponent as StarFull } from './../../common/images/star-full.svg';\nimport './styles/completeDialog.scss';\n\ninterface Props {\n  headerText: string;\n  scoreText: string;\n  tryAgainText: string;\n  exitText: string;\n  total: number;\n  mistakes: number;\n  onTryAgain: () => void;\n  onExit: () => void;\n}\n\nconst CompleteDialog = (props: Props) => {\n  const { total, mistakes } = props;\n  const score = Math.max(total - mistakes, 0);\n\n  useEffect(() => {\n    // @ts-ignore\n    if (window.setLevelScore) window.setLevelScore(1, score, total); \n  }, [score, total]);\n\n  const renderStars = () => {\n    const result = [];\n    for (let i = 0; i < total; i++) {\n      result.push(\n        <div key={`star${i}`}>\n          <StarEmpty />\n          {i < score && (<StarFull className=\"full\"/>)}\n        </div>\n      )\n    }\n    return result;\n  }\n\n  return (\n    <BaseDialog className=\"complete-dialog\">\n      {/* <div className=\"top\">\n        <h1>{props.headerText}</h1>\n      </div>\n      <div className=\"center\">\n        <section>{props.descriptionText}</section>\n    </div>*/}\n      <div className=\"block\">\n        <h1>{props.headerText}</h1>\n      </div>\n      <div className=\"block score\">\n        {props.scoreText\n          .replace(\"{0}\", score.toString())\n          .replace(\"{1}\", total.toString())\n        }\n      </div>\n      <div className=\"block stars\">\n        {renderStars()}\n      </div>\n      <div className=\"bottom\">\n        {/* <StarEmpty className=\"star\"/> */}\n        <button className=\"green button\" onClick={props.onTryAgain}>\n          {props.tryAgainText}\n        </button>\n        <button className=\"red button\" onClick={props.onExit}>\n          {props.exitText}\n        </button>\n      </div>\n    </BaseDialog>\n  );\n}\n\nexport default CompleteDialog;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}